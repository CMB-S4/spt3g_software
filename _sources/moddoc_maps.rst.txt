.. include:: intro_maps.rst

API Documentation
=================

.. contents:: Contents
   :depth: 1
   :local:

Frame Objects
-------------

Serializable objects that may be stored as entries in :py:class:`~spt3g.core.G3Frame` objects.

.. autoclass:: spt3g.maps.FlatSkyMap

.. autoclass:: spt3g.maps.G3SkyMapMask

.. autoclass:: spt3g.maps.G3SkyMapWeights

.. autoclass:: spt3g.maps.HealpixSkyMap

Class-like Pipeline Modules
---------------------------


Classes that can be added to :py:class:`~spt3g.core.G3Pipeline`
instances, either written as callable objects in Python (see
:ref:`class-modules`) or as :py:class:`~spt3g.core.G3Module`-derived
classes in C++ (see :ref:`cxx-modules`).  Aside from adding these into
pipelines using the standard ``Add()`` method, such objects may also be
instantiated outside of pipelines to make use of additional features.

One typical use case is to extract some kind of data from a series of
frames::

    class ExtractData:
        def __init__(self, key="RawTimestreams"):
            self.key = key
            self.data = []
        def __call__(self, frame):
            if self.key in frame:
                self.data.append(frame[self.key])

    # instantiate caching class
    extractor = ExtractData()

    # use instance in a pipeline
    pipe = core.G3Pipeline()
    pipe.Add(core.G3Reader, filename="file.g3")
    pipe.Add(extractor)
    pipe.Run()

    # use extracted data in later processing
    print(extractor.data)

Another use case may be to call additional methods of a class.  For
example, the :py:class:`~spt3g.core.G3Writer` class can be used as a
context manager, and also report the position of the file pointer after
each frame is written::

    with core.G3Writer("file.g3") as writer:
        for frame in frames:
            writer(frame)
            print("Bytes written:", writer.tell())

Class-like modules permit a variety of additional features beyond
their standard usage in pipelines.


.. autoclass:: spt3g.maps.HitsBinner

.. autoclass:: spt3g.maps.MapBinner

.. autoclass:: spt3g.maps.MapMockObserver

.. autoclass:: spt3g.maps.MapTODMasker

.. autoclass:: spt3g.maps.MapTODPointing

.. autoclass:: spt3g.maps.SingleDetectorBoresightBinner

.. autoclass:: spt3g.maps.SingleDetectorMapBinner

.. autoclass:: spt3g.maps.map_modules.CoaddMaps

.. autoclass:: spt3g.maps.map_modules.ExtractMaps

.. autoclass:: spt3g.maps.map_modules.InjectMapStub

.. autoclass:: spt3g.maps.map_modules.InjectMaps

.. autoclass:: spt3g.maps.map_modules.ReprojectMaps

Function-like Pipeline Modules
------------------------------

Python functions that can be added to :py:class:`~spt3g.core.G3Pipeline` instances. Such functions may also be called directly with a :py:class:`~spt3g.core.G3Frame` object as the first argument, and do not necessarily need to be used in a pipeline. See :ref:`function-modules` for more detail.

.. autofunction:: spt3g.maps.azel.EquatorialToGalacticPointing

.. autofunction:: spt3g.maps.azel.LocalToAstronomicalPointing

.. autofunction:: spt3g.maps.coordsysmodules.AddLocalTransRotations

.. autofunction:: spt3g.maps.coordsysmodules.EquatorialToGalacticTransRotations

.. autofunction:: spt3g.maps.coordsysmodules.FillCoordTransRotations

.. autofunction:: spt3g.maps.fitsio.SaveMapFrame

.. autofunction:: spt3g.maps.map_modules.ApplyWeights

.. autofunction:: spt3g.maps.map_modules.CompactMaps

.. autofunction:: spt3g.maps.map_modules.FlattenPol

.. autofunction:: spt3g.maps.map_modules.MakeMapsPolarized

.. autofunction:: spt3g.maps.map_modules.MakeMapsUnpolarized

.. autofunction:: spt3g.maps.map_modules.RebinMaps

.. autofunction:: spt3g.maps.map_modules.RemoveWeights

.. autofunction:: spt3g.maps.map_modules.ReplicateMaps

.. autofunction:: spt3g.maps.map_modules.SetPolConv

.. autofunction:: spt3g.maps.map_modules.ValidateMaps

.. autofunction:: spt3g.maps.quathelpers.AddTimingToPointingQuats

Useful Classes
--------------

Various Python and C++ classes that are part of the public API.

.. autoclass:: spt3g.maps.G3SkyMap

.. autoclass:: spt3g.maps.MapCoordReference

.. autoclass:: spt3g.maps.MapPolConv

.. autoclass:: spt3g.maps.MapPolType

.. autoclass:: spt3g.maps.MapProjection

Useful Functions
----------------

Various Python and C++ functions that are part of the public API.

.. autofunction:: spt3g.maps.apply_weights

.. autofunction:: spt3g.maps.apply_weights_t

.. autofunction:: spt3g.maps.azel.convert_azel_to_radec

.. autofunction:: spt3g.maps.azel.convert_gal_to_radec

.. autofunction:: spt3g.maps.azel.convert_radec_to_azel

.. autofunction:: spt3g.maps.azel.convert_radec_to_gal

.. autofunction:: spt3g.maps.convolve_map

.. autofunction:: spt3g.maps.fitsio.load_skymap_fits

.. autofunction:: spt3g.maps.fitsio.save_skymap_fits

.. autofunction:: spt3g.maps.flatten_pol

.. autofunction:: spt3g.maps.get_boresight_rotator_timestream

.. autofunction:: spt3g.maps.get_fk5_j2000_to_gal_quat

.. autofunction:: spt3g.maps.get_galactic_plane_mask

.. autofunction:: spt3g.maps.get_map_hist

.. autofunction:: spt3g.maps.get_map_moments

.. autofunction:: spt3g.maps.get_origin_rotator

.. autofunction:: spt3g.maps.get_origin_rotator_timestream

.. autofunction:: spt3g.maps.get_ra_dec_map

.. autofunction:: spt3g.maps.get_ra_dec_mask

.. autofunction:: spt3g.maps.get_rot_ang

.. autofunction:: spt3g.maps.get_transform_quat

.. autofunction:: spt3g.maps.make_point_source_mask

.. autofunction:: spt3g.maps.map_modules.coadd_map_files

.. autofunction:: spt3g.maps.maputils.flatsky_to_healpix

.. autofunction:: spt3g.maps.maputils.healpix_to_flatsky

.. autofunction:: spt3g.maps.offsets_to_quat

.. autofunction:: spt3g.maps.quathelpers.ang_to_quat

.. autofunction:: spt3g.maps.quathelpers.quat_to_ang

.. autofunction:: spt3g.maps.remove_weights

.. autofunction:: spt3g.maps.remove_weights_t

.. autofunction:: spt3g.maps.reproj_map


