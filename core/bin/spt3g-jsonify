#!/usr/bin/env python3

import sys
from spt3g import core

 
if len(sys.argv) < 2:
    print('Usage: %s file.g3 ' % sys.argv[0])
    print('Dumps the given file to standard output as JSON (not quite indented properly, sorry)')
    sys.exit(1)

#Crappy hand-crafted json wrapper to make this stream valid json
print('{') 
print('    "filename": "%s",' % (sys.argv[1]))
print('    "frames":')
print('     [') 

first = True
indent = 8*' '
print_indent = 7*' '

for f in core.G3File(sys.argv[1]):
	if not first: 
		print (print_indent,',')
	print(print_indent,indent.join(f.as_json().splitlines(True)))
	first = False 
print('    ]')
print('}') 

