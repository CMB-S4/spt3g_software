<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>calibration &#8212; SPT3G Software  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="_static/nature.css?v=0f882399" />
    <script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="core" href="moddoc_core.html" />
    <link rel="prev" title="Common Problems" href="commonissues.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="moddoc_core.html" title="core"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="commonissues.html" title="Common Problems"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">SPT3G Software  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">calibration</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="calibration">
<h1>calibration<a class="headerlink" href="#calibration" title="Link to this heading">¶</a></h1>
<p>The calibration project contains data classes and analysis code for storing the following things:</p>
<dl>
<dt><em>Physical properties of the bolometers</em></dt><dd><p>This includes the relative pointing offsets of the detectors on the focal plane, their polarization angles and efficiences, their bands, and the fabrication name (physical name) of the detector to which the channel corresponds. It does <em>not</em> include tuning-dependent parameters like time constants or responsivity. This information is stored in a <code class="docutils literal notranslate"><span class="pre">BolometerPropertiesMap</span></code>, indexed by logical bolometer ID, in the Calibration frame. The standard name for this object is “BolometerProperties” and it is created from a composite of other calibration information.</p>
<p>The frequency band for a bolometer is often represented by a string name with units.  The <code class="docutils literal notranslate"><span class="pre">BandFormat</span></code> class provides some functions for converting numerical bands (in G3Units) to their string representation.  A global instance of this class is instantiated, for ensuring consistent band formatting throughout the library code.  By default, the band string is formatted with precision 0 (i.e. an integer) in units of GHz; these can be modified by using the <code class="docutils literal notranslate"><span class="pre">set_band_format()</span></code> function.  The <code class="docutils literal notranslate"><span class="pre">band_to_string()</span></code> and <code class="docutils literal notranslate"><span class="pre">band_to_value()</span></code> functions can be used to convert numerical band values to their string representation and vice versa.  The <code class="docutils literal notranslate"><span class="pre">extract_band_string()</span></code> and <code class="docutils literal notranslate"><span class="pre">extract_band_value()</span></code> functions can be used to extract band information in string or numerical form from other strings.  Library code should take care to use these functions wherever possible.</p>
<p>In addition, the <code class="docutils literal notranslate"><span class="pre">.band_string</span></code> property of a <code class="docutils literal notranslate"><span class="pre">BolometerProperties</span></code> instance returns the string representation of the given bolometer’s frequency band, using the global formatting specification.</p>
</dd>
</dl>
<section id="modules-in-spt3g-calibration">
<h2>Modules in spt3g.calibration<a class="headerlink" href="#modules-in-spt3g-calibration" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="#spt3g-calibration-bolopropertiesutils-splitbyband">spt3g.calibration.bolopropertiesutils.SplitByBand</a></p></li>
<li><p><a class="reference internal" href="#spt3g-calibration-bolopropertiesutils-splitbypixeltype">spt3g.calibration.bolopropertiesutils.SplitByPixelType</a></p></li>
<li><p><a class="reference internal" href="#spt3g-calibration-bolopropertiesutils-splitbyproperty">spt3g.calibration.bolopropertiesutils.SplitByProperty</a></p></li>
<li><p><a class="reference internal" href="#spt3g-calibration-bolopropertiesutils-splitbywafer">spt3g.calibration.bolopropertiesutils.SplitByWafer</a></p></li>
<li><p><a class="reference internal" href="#spt3g-calibration-bolopropertiesutils-splittimestreamsbyband">spt3g.calibration.bolopropertiesutils.SplitTimestreamsByBand</a></p></li>
<li><p><a class="reference internal" href="#spt3g-calibration-build-cal-frames-buildbolopropertiesmap">spt3g.calibration.build_cal_frames.BuildBoloPropertiesMap</a></p></li>
<li><p><a class="reference internal" href="#spt3g-calibration-build-cal-frames-buildpointingproperties">spt3g.calibration.build_cal_frames.BuildPointingProperties</a></p></li>
<li><p><a class="reference internal" href="#spt3g-calibration-build-cal-frames-explodebolometerproperties">spt3g.calibration.build_cal_frames.ExplodeBolometerProperties</a></p></li>
<li><p><a class="reference internal" href="#spt3g-calibration-build-cal-frames-mergecalibrationframes">spt3g.calibration.build_cal_frames.MergeCalibrationFrames</a></p></li>
</ul>
<p id="spt3g-calibration-bolopropertiesutils-splitbyband"><strong>spt3g.calibration.bolopropertiesutils.SplitByBand</strong></p>
<p>Take an input G3FrameObject-derivative Map keyed by bolometer name and
split it into several based on the bands of the detectors as given by
the BolometerProperties key.
Return the same type of maps as the one it was handed, e.g.
G3TimestreamMap, G3MapInt, etc.</p>
<dl class="simple">
<dt><em>Constructor:</em></dt><dd><p><code class="docutils literal notranslate"><span class="pre">SplitByBand(self,</span> <span class="pre">input='CalTimestreams',</span> <span class="pre">output_root=None,</span> <span class="pre">bands=None,</span> <span class="pre">bpm='BolometerProperties',</span> <span class="pre">drop_empty=False)</span></code></p>
</dd>
<dt><em>Constructor:</em></dt><dd><p>Split the input map given by input into several output
maps named output_root + band + GHz (e.g. CalTimestreams150GHz with
the default options). If bands is not None, use only the bands in the
list (possibly writing empty timestream maps to the frame). Otherwise,
creates maps for every band that exists in the input. Setting bpm
to a non-default value causes this to get its band mapping from an
alternative data source.</p>
</dd>
</dl>
<p id="spt3g-calibration-bolopropertiesutils-splitbypixeltype"><strong>spt3g.calibration.bolopropertiesutils.SplitByPixelType</strong></p>
<p>Take an input G3FrameObject-derivative Map keyed by bolometer name and
split it into several based on the pixel types of the detectors as given by
the BolometerProperties key.
Return the same type of maps as the one it was handed, e.g.
G3TimestreamMap, G3MapInt, etc.</p>
<dl class="simple">
<dt><em>Constructor:</em></dt><dd><p><code class="docutils literal notranslate"><span class="pre">SplitByPixelType(self,</span> <span class="pre">input='CalTimestreams',</span> <span class="pre">output_root=None,</span> <span class="pre">types=None,</span> <span class="pre">bpm='BolometerProperties',</span> <span class="pre">drop_empty=False)</span></code></p>
</dd>
<dt><em>Constructor:</em></dt><dd><p>Split the input map given by input into several output
maps named output_root + wafer (e.g. CalTimestreamsW172 with
the default options). If wafers is not None, use only the wafers in the
list (possibly writing empty timestream maps to the frame). Otherwise,
creates maps for every wafer that exists in the input. Setting bpm
to a non-default value causes this to get its wafer mapping from an
alternative data source.</p>
</dd>
</dl>
<p id="spt3g-calibration-bolopropertiesutils-splitbyproperty"><strong>spt3g.calibration.bolopropertiesutils.SplitByProperty</strong></p>
<p>Take an input G3FrameObject-derivative Map keyed by bolometer name and
split it into several based on the property of the detectors as given by
the BolometerProperties key.
Return the same type of maps as the one it was handed, e.g.
G3TimestreamMap, G3MapInt, etc.</p>
<dl>
<dt><em>Constructor:</em></dt><dd><p><code class="docutils literal notranslate"><span class="pre">SplitByProperty(self,</span> <span class="pre">input='CalTimestreams',</span> <span class="pre">property=None,</span> <span class="pre">property_list=None,</span> <span class="pre">output_root=None,</span> <span class="pre">bpm='BolometerProperties',</span> <span class="pre">drop_empty=False)</span></code></p>
</dd>
<dt><em>Constructor:</em></dt><dd><p>Split the input map given by input into several output
maps named output_root + key (e.g. CalTimestreams + str(property)) with
the default options).</p>
<dl class="simple">
<dt><em>Arguments:</em></dt><dd><dl class="simple">
<dt>input<span class="classifier">str</span></dt><dd><p>Key name of the input map to split.</p>
</dd>
<dt>property<span class="classifier">str</span></dt><dd><p>Attribute name to extract from the BolometerProperties object.
Required.</p>
</dd>
<dt>property_list<span class="classifier">list of properties</span></dt><dd><p>Properties to include in the output keys.  Entries that are not strings
will be converted to strings using the <cite>SplitByProperty.converter</cite> method.
If property_list is not None, use only the names in the
list (possibly writing empty timestream maps to the frame). Otherwise,
creates maps for every that exists in the input.</p>
</dd>
<dt>output_root<span class="classifier">str</span></dt><dd><p>Prefix for the output keys.
If None (default), use <cite>input</cite> as the output root.</p>
</dd>
<dt>bpm<span class="classifier">str</span></dt><dd><p>The key name of the BolometerPropertiesMap from which to extract
the requested <cite>property</cite> for splitting the input map.</p>
</dd>
<dt>drop_empty<span class="classifier">bool</span></dt><dd><p>If True, drop output maps that don’t contain any bolometers.</p>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
<p id="spt3g-calibration-bolopropertiesutils-splitbywafer"><strong>spt3g.calibration.bolopropertiesutils.SplitByWafer</strong></p>
<p>Take an input G3FrameObject-derivative Map keyed by bolometer name and
split it into several based on the wafers of the detectors as given by
the BolometerProperties key.
Return the same type of maps as the one it was handed, e.g.
G3TimestreamMap, G3MapInt, etc.</p>
<dl class="simple">
<dt><em>Constructor:</em></dt><dd><p><code class="docutils literal notranslate"><span class="pre">SplitByWafer(self,</span> <span class="pre">input='CalTimestreams',</span> <span class="pre">output_root=None,</span> <span class="pre">wafers=None,</span> <span class="pre">bpm='BolometerProperties',</span> <span class="pre">drop_empty=False)</span></code></p>
</dd>
<dt><em>Constructor:</em></dt><dd><p>Split the input map given by input into several output
maps named output_root + wafer (e.g. CalTimestreamsW172 with
the default options). If wafers is not None, use only the wafers in the
list (possibly writing empty timestream maps to the frame). Otherwise,
creates maps for every wafer that exists in the input. Setting bpm
to a non-default value causes this to get its wafer mapping from an
alternative data source.</p>
</dd>
</dl>
<p id="spt3g-calibration-bolopropertiesutils-splittimestreamsbyband"><strong>spt3g.calibration.bolopropertiesutils.SplitTimestreamsByBand</strong></p>
<p>Take an input G3FrameObject-derivative Map keyed by bolometer name and
split it into several based on the bands of the detectors as given by
the BolometerProperties key.
Return the same type of maps as the one it was handed, e.g.
G3TimestreamMap, G3MapInt, etc.</p>
<dl class="simple">
<dt><em>Constructor:</em></dt><dd><p><code class="docutils literal notranslate"><span class="pre">SplitTimestreamsByBand(self,</span> <span class="pre">input='CalTimestreams',</span> <span class="pre">output_root=None,</span> <span class="pre">bands=None,</span> <span class="pre">bpm='BolometerProperties',</span> <span class="pre">drop_empty=False)</span></code></p>
</dd>
<dt><em>Constructor:</em></dt><dd><p>Split the input map given by input into several output
maps named output_root + band + GHz (e.g. CalTimestreams150GHz with
the default options). If bands is not None, use only the bands in the
list (possibly writing empty timestream maps to the frame). Otherwise,
creates maps for every band that exists in the input. Setting bpm
to a non-default value causes this to get its band mapping from an
alternative data source.</p>
</dd>
</dl>
<p id="spt3g-calibration-build-cal-frames-buildbolopropertiesmap"><strong>spt3g.calibration.build_cal_frames.BuildBoloPropertiesMap</strong></p>
<p>Build bolometer properties map from raw calibration sub-frames emitted
by other processing scripts. Input data are maps of bolo ID to floats
or, in the case of names, strings. If multiple instance of each data
class appear, the final bolometer properties map will be the median
of the input values.</p>
<p>Expects to be passed frames from:
- RCW38 Relative Pointing Offset Calibration (Keys: ‘PointingOffsetX’, ‘PointingOffsetY’)
- CenA Angle Calibration (Keys: ‘PolarizationAngle’, ‘PolarizationEfficiency’)
- Band Calibration (Key: ‘BoloBands’)
- Physical Name Data (Key: ‘PhysicalBoloIDs’)</p>
<dl>
<dt><em>Constructor:</em></dt><dd><p><code class="docutils literal notranslate"><span class="pre">BuildBoloPropertiesMap(self,</span> <span class="pre">drop_original_frames=True,</span> <span class="pre">fiducial_detectors=[],</span> <span class="pre">bpm_name='NominalBolometerProperties',</span> <span class="pre">use_bpm_pointing=False)</span></code></p>
</dd>
<dt><em>Constructor:</em></dt><dd><p>If drop_original_frames is True, will drop all input Calibration frames.</p>
<p>If fiducial_detectors is set, will use the average of the position[s] of
whatever detector[s] are specified to center each set of relative offsets
encountered (NB: this recentering is done in a Cartesian way). If it is
<em>not</em> specified, five detectors near the middle of the focal plane present
in every observation given will be chosen automatically and printed to the
console.</p>
<p>bpm_name is the name of the key containing the input BolometerPropertiesMap
that will be merged into the output map.</p>
<p>If use_bpm_pointing is True, then the pointing information is extracted
from the input BolometerPropertiesMap.  If False, pointing information
must be supplied in an additional input frame.</p>
</dd>
</dl>
<p id="spt3g-calibration-build-cal-frames-buildpointingproperties"><strong>spt3g.calibration.build_cal_frames.BuildPointingProperties</strong></p>
<p>Build pointing properties from raw calibration sub-frames emitted
by other processing scripts. Input data are floats, including
tilt information, and eventually other pointing model values.</p>
<p>Expects to be passed frames from:
- Az tilt fit parameters (Keys: ‘tiltAngle’, ‘tiltHA’, ‘tiltLat’, ‘tiltMag’)</p>
<dl class="simple">
<dt><em>Constructor:</em></dt><dd><p><code class="docutils literal notranslate"><span class="pre">BuildPointingProperties(self,</span> <span class="pre">drop_original_frames=True)</span></code></p>
</dd>
<dt><em>Constructor:</em></dt><dd><p>If drop_original_frames is True, will drop all input Calibration frames.</p>
</dd>
</dl>
<p id="spt3g-calibration-build-cal-frames-explodebolometerproperties"><strong>spt3g.calibration.build_cal_frames.ExplodeBolometerProperties</strong></p>
<p>Take a bolometer properties map (usually the nominal one) and convert it
into its constituent keys as though they came from real calibration. This
is the inverse of BuildBoloPropertiesMap and mostly is useful when combining
hardware map information with real calibration.</p>
<dl class="simple">
<dt><em>Definition:</em></dt><dd><p><code class="docutils literal notranslate"><span class="pre">ExplodeBolometerProperties(frame,</span> <span class="pre">bpmname='NominalBolometerProperties')</span></code></p>
</dd>
</dl>
<p id="spt3g-calibration-build-cal-frames-mergecalibrationframes"><strong>spt3g.calibration.build_cal_frames.MergeCalibrationFrames</strong></p>
<p>Merge the keys from a sequence of calibration frames. Will throw an
exception if a key recurs in more than one calibration frame. The merged
calibration frame will be emitted before the first non-calibration frame
that follows a calibration frame or at the end of processing, whichever
comes first. Other non-calibration frames will be ignored.</p>
<dl class="simple">
<dt><em>Constructor:</em></dt><dd><p><code class="docutils literal notranslate"><span class="pre">MergeCalibrationFrames(self,</span> <span class="pre">KeysToIgnore=['PointingOffsetX',</span> <span class="pre">'PointingOffsetY'])</span></code></p>
</dd>
<dt><em>Constructor:</em></dt><dd><p>Ignores keys in the KeysToIgnore list during merging. By default, set
to values written by the flux/pointing calibration that are stored to
the BolometerPropertiesMap.</p>
</dd>
</dl>
</section>
<section id="functions-in-spt3g-calibration">
<h2>Functions in spt3g.calibration<a class="headerlink" href="#functions-in-spt3g-calibration" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="#spt3g-calibration-bolopropertiesutils-band-to-string">spt3g.calibration.bolopropertiesutils.band_to_string</a></p></li>
<li><p><a class="reference internal" href="#spt3g-calibration-bolopropertiesutils-band-to-value">spt3g.calibration.bolopropertiesutils.band_to_value</a></p></li>
<li><p><a class="reference internal" href="#spt3g-calibration-bolopropertiesutils-extract-band-string">spt3g.calibration.bolopropertiesutils.extract_band_string</a></p></li>
<li><p><a class="reference internal" href="#spt3g-calibration-bolopropertiesutils-extract-band-value">spt3g.calibration.bolopropertiesutils.extract_band_value</a></p></li>
<li><p><a class="reference internal" href="#spt3g-calibration-bolopropertiesutils-get-band-units">spt3g.calibration.bolopropertiesutils.get_band_units</a></p></li>
<li><p><a class="reference internal" href="#spt3g-calibration-bolopropertiesutils-set-band-format">spt3g.calibration.bolopropertiesutils.set_band_format</a></p></li>
</ul>
<p id="spt3g-calibration-bolopropertiesutils-band-to-string"><strong>spt3g.calibration.bolopropertiesutils.band_to_string</strong></p>
<p>Convert a band value in G3Units to its string representation, using
the appropriate precision and units name.</p>
<dl class="simple">
<dt><em>Definition:</em></dt><dd><p><code class="docutils literal notranslate"><span class="pre">band_to_string(value,</span> <span class="pre">include_units=True)</span></code></p>
</dd>
</dl>
<p id="spt3g-calibration-bolopropertiesutils-band-to-value"><strong>spt3g.calibration.bolopropertiesutils.band_to_value</strong></p>
<p>Convert a band string to a value in G3Units, or raise a ValueError
if no match is found.</p>
<dl class="simple">
<dt><em>Definition:</em></dt><dd><p><code class="docutils literal notranslate"><span class="pre">band_to_value(string)</span></code></p>
</dd>
</dl>
<p id="spt3g-calibration-bolopropertiesutils-extract-band-string"><strong>spt3g.calibration.bolopropertiesutils.extract_band_string</strong></p>
<p>Return the band substring from the input string, or None if not
found.</p>
<dl class="simple">
<dt><em>Definition:</em></dt><dd><p><code class="docutils literal notranslate"><span class="pre">extract_band_string(string,</span> <span class="pre">include_units=True)</span></code></p>
</dd>
</dl>
<p id="spt3g-calibration-bolopropertiesutils-extract-band-value"><strong>spt3g.calibration.bolopropertiesutils.extract_band_value</strong></p>
<p>Return the band in G3Units extracted from the input string, or None
if not found.</p>
<dl class="simple">
<dt><em>Definition:</em></dt><dd><p><code class="docutils literal notranslate"><span class="pre">extract_band_value(string)</span></code></p>
</dd>
</dl>
<p id="spt3g-calibration-bolopropertiesutils-get-band-units"><strong>spt3g.calibration.bolopropertiesutils.get_band_units</strong></p>
<p>Return the units string used for formatting frequency band values.</p>
<dl class="simple">
<dt><em>Definition:</em></dt><dd><p><code class="docutils literal notranslate"><span class="pre">get_band_units()</span></code></p>
</dd>
</dl>
<p id="spt3g-calibration-bolopropertiesutils-set-band-format"><strong>spt3g.calibration.bolopropertiesutils.set_band_format</strong></p>
<p>Set the band format precision and units for converting between a
quantity in G3Units and its string representation.</p>
<dl class="simple">
<dt><em>Arguments:</em></dt><dd><dl class="simple">
<dt>precision<span class="classifier">int</span></dt><dd><p>Float formatting precision for the band quantity.  If &lt;=0, output
will be an integer.  If &gt;0, output will be a floating point number
with this many decimal places of precision.</p>
</dd>
<dt>units<span class="classifier">str</span></dt><dd><p>String name of the G3Units quantity in which to represent the
frequency band, e.g. “GHz” or “MHz”.  Must correspond to a valid
attribute of the core.G3Units namespace.</p>
</dd>
</dl>
</dd>
<dt><em>Definition:</em></dt><dd><p><code class="docutils literal notranslate"><span class="pre">set_band_format(precision,</span> <span class="pre">units)</span></code></p>
</dd>
</dl>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">calibration</a><ul>
<li><a class="reference internal" href="#modules-in-spt3g-calibration">Modules in spt3g.calibration</a></li>
<li><a class="reference internal" href="#functions-in-spt3g-calibration">Functions in spt3g.calibration</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="commonissues.html"
                          title="previous chapter">Common Problems</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="moddoc_core.html"
                          title="next chapter">core</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/moddoc_calibration.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="moddoc_core.html" title="core"
             >next</a> |</li>
        <li class="right" >
          <a href="commonissues.html" title="Common Problems"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">SPT3G Software  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">calibration</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright .
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.0.2.
    </div>
  </body>
</html>