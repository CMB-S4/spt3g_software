

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>spt3g.maps.map_modules &mdash; SPT-3G Software  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../_static/custom.css?v=0517cd0f" />

  
    <link rel="shortcut icon" href="../../../_static/spt_outlines_white.png"/>
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            SPT-3G Software
              <img src="../../../_static/spt_outlines.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">General Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../quickstart.html">Quick Start</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../quickstart.html#how-to-install">How to Install</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../quickstart.html#installing-dependencies-on-a-personal-system">Installing Dependencies on a Personal System</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../quickstart.html#handling-dependencies-on-the-open-science-grid">Handling Dependencies on the Open Science Grid</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../quickstart.html#handling-dependencies-on-nersc">Handling Dependencies on NERSC</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../quickstart.html#compilation">Compilation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../quickstart.html#installation">Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../quickstart.html#installation-with-pip">Installation with Pip</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../quickstart.html#overview">Overview</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../quickstart.html#frames">Frames</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../quickstart.html#id1">Modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../quickstart.html#pipelines">Pipelines</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../quickstart.html#io">IO</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../quickstart.html#frame-objects">Frame Objects</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../quickstart.html#units">Units</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../quickstart.html#debugging-code">Debugging Code</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">Modules</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../modules.html#writing-a-module-in-python">Writing a module in Python</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../modules.html#python-modules-as-functions">Python Modules as Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules.html#return-values-from-python-modules">Return values from Python modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules.html#im-mutability-of-frame-objects">(Im)mutability of frame objects</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules.html#the-first-module">The first module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules.html#callable-objects-as-functions">Callable Objects as Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules.html#autodocumentation-of-modules">Autodocumentation of modules</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules.html#writing-a-module-in-c">Writing a module in C++</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules.html#pipeline-segments">Pipeline Segments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules.html#advanced-techniques-buffering-data">Advanced Techniques: Buffering Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules.html#caching-previous-data">Caching Previous Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules.html#pipelines">Pipelines</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../modules.html#pipeline-add">Pipeline.Add</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules.html#pipeline-run">Pipeline.Run</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules.html#g3pipelineinfo">G3PipelineInfo</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../frames.html">Frames</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../frames.html#scan">Scan</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../frames.html#pipelineinfo">PipelineInfo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../frames.html#timepoint">Timepoint</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../frames.html#housekeeping">Housekeeping</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../frames.html#map">Map</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../frames.html#calibration">Calibration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../frames.html#observation">Observation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../frames.html#wiring">Wiring</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../frames.html#gcpslow">GcpSlow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../frames.html#endprocessing">EndProcessing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../logging.html">Logging</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../logging.html#setting-log-levels">Setting Log Levels</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../logging.html#using-logging-from-python">Using Logging from Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../logging.html#using-logging-from-c">Using Logging from C++</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../fileio.html">File IO</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../fileio.html#g3reader">G3Reader</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../fileio.html#g3writer">G3Writer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../fileio.html#g3multifilewriter">G3MultiFileWriter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../fileio.html#g3file">G3File</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../fileio.html#file-format">File Format</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../fileio.html#frame-structure-on-disk">Frame Structure on Disk</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../fileio.html#blobs">Blobs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../fileio.html#miscellany">Miscellany</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../units.html">Units</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../units.html#defining-a-quantity-with-units">Defining a quantity with units</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../units.html#converting-to-different-units">Converting to different units</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../units.html#available-units">Available units</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../units.html#time">Time</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../units.html#frequency">Frequency</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../units.html#angles">Angles</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../units.html#length">Length</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../units.html#power">Power</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../units.html#flux-density">Flux Density</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../units.html#solid-angle">Solid Angle</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../units.html#voltage">Voltage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../units.html#current">Current</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../units.html#resistance">Resistance</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../units.html#temperature">Temperature</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../units.html#pressure">Pressure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../units.html#data-size">Data Size</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../units.html#mass">Mass</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../units.html#common-scientific-constants">Common scientific constants</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../dataacquisition.html">Data Acquisition</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../dataacquisition.html#dfmux">DfMux</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../dataacquisition.html#bolometer-data">Bolometer Data</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../dataacquisition.html#sctp">SCTP</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dataacquisition.html#udp">UDP</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dataacquisition.html#legacy-boards">Legacy Boards</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dataacquisition.html#data-structures">Data Structures</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../dataacquisition.html#housekeeping-data">Housekeeping Data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../dataacquisition.html#building-timestreams">Building Timestreams</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../dataacquisition.html#the-wiring-map">The Wiring Map</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../dataacquisition.html#dfmuxcollator">DfMuxCollator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../dataacquisition.html#collecting-data-to-a-netcdf-file">Collecting data to a NetCDF file</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../dataacquisition.html#core-tools">Core Tools</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../dataacquisition.html#g3eventbuilder">G3EventBuilder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../dataacquisition.html#g3triggeredbuilder">G3TriggeredBuilder</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../dataacquisition.html#ledgerman">ledgerman</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../autodoc.html">Auto-documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../autodoc.html#getting-it-documented">Getting it documented</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../autodoc.html#viewing-the-docs">Viewing the docs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../buildsystem.html">Build System</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../buildsystem.html#cmake-overview">CMake Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../buildsystem.html#adding-a-project">Adding a Project</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../buildsystem.html#adding-python-code">Adding Python code</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../buildsystem.html#adding-a-c-library">Adding a C++ library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../buildsystem.html#adding-a-c-executable">Adding a C++ executable</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../buildsystem.html#adding-tests">Adding tests</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../buildsystem.html#python-tests">Python Tests</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../buildsystem.html#c-tests">C++ Tests</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../buildsystem.html#mixing-c-and-python">Mixing C++ and Python</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../styleguide.html">Style Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../styleguide.html#version-control-hygiene">Version Control Hygiene</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../styleguide.html#git">Git</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../styleguide.html#svn">SVN</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../styleguide.html#coding-style">Coding Style</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../styleguide.html#python-style-guide">Python Style Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../styleguide.html#c-style-guide">C++ Style Guide</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../networkstreaming.html">Network Streaming</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../networkstreaming.html#g3networksender">G3NetworkSender</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../networkstreaming.html#connecting-to-a-remote-reader">Connecting to a Remote Reader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../networkstreaming.html#functioning-as-a-streaming-server">Functioning as a Streaming Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../networkstreaming.html#throttling-output-data">Throttling output data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../networkstreaming.html#using-g3reader-over-the-network">Using G3Reader Over the Network</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../commonissues.html">Common Problems</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../commonissues.html#setting-values-of-a-flatskymap">Setting Values of a FlatSkyMap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../commonissues.html#error-message-decryption">Error Message Decryption</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../commonissues.html#argument-errors">Argument Errors</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../commonissues.html#misbehaving-compilers">Misbehaving Compilers</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Module Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../moddoc_calibration.html">calibration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../moddoc_calibration.html#api-documentation">API Documentation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../moddoc_calibration.html#frame-objects">Frame Objects</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_calibration.html#spt3g.calibration.BolometerProperties"><code class="docutils literal notranslate"><span class="pre">BolometerProperties</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_calibration.html#spt3g.calibration.BolometerPropertiesMap"><code class="docutils literal notranslate"><span class="pre">BolometerPropertiesMap</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_calibration.html#spt3g.calibration.PointingProperties"><code class="docutils literal notranslate"><span class="pre">PointingProperties</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_calibration.html#spt3g.calibration.PointingPropertiesMap"><code class="docutils literal notranslate"><span class="pre">PointingPropertiesMap</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../moddoc_calibration.html#class-like-pipeline-modules">Class-like Pipeline Modules</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_calibration.html#spt3g.calibration.bolopropertiesutils.SplitByBand"><code class="docutils literal notranslate"><span class="pre">SplitByBand</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_calibration.html#spt3g.calibration.bolopropertiesutils.SplitByPixelType"><code class="docutils literal notranslate"><span class="pre">SplitByPixelType</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_calibration.html#spt3g.calibration.bolopropertiesutils.SplitByProperty"><code class="docutils literal notranslate"><span class="pre">SplitByProperty</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_calibration.html#spt3g.calibration.bolopropertiesutils.SplitByWafer"><code class="docutils literal notranslate"><span class="pre">SplitByWafer</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_calibration.html#spt3g.calibration.bolopropertiesutils.SplitTimestreamsByBand"><code class="docutils literal notranslate"><span class="pre">SplitTimestreamsByBand</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_calibration.html#spt3g.calibration.build_cal_frames.BuildBoloPropertiesMap"><code class="docutils literal notranslate"><span class="pre">BuildBoloPropertiesMap</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_calibration.html#spt3g.calibration.build_cal_frames.BuildPointingProperties"><code class="docutils literal notranslate"><span class="pre">BuildPointingProperties</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_calibration.html#spt3g.calibration.build_cal_frames.MergeCalibrationFrames"><code class="docutils literal notranslate"><span class="pre">MergeCalibrationFrames</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../moddoc_calibration.html#function-like-pipeline-modules">Function-like Pipeline Modules</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_calibration.html#spt3g.calibration.build_cal_frames.ExplodeBolometerProperties"><code class="docutils literal notranslate"><span class="pre">ExplodeBolometerProperties()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../moddoc_calibration.html#useful-classes">Useful Classes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_calibration.html#spt3g.calibration.BolometerCouplingType"><code class="docutils literal notranslate"><span class="pre">BolometerCouplingType</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../moddoc_calibration.html#useful-functions">Useful Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_calibration.html#spt3g.calibration.bolopropertiesutils.band_to_string"><code class="docutils literal notranslate"><span class="pre">band_to_string()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_calibration.html#spt3g.calibration.bolopropertiesutils.band_to_value"><code class="docutils literal notranslate"><span class="pre">band_to_value()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_calibration.html#spt3g.calibration.bolopropertiesutils.extract_band_string"><code class="docutils literal notranslate"><span class="pre">extract_band_string()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_calibration.html#spt3g.calibration.bolopropertiesutils.extract_band_value"><code class="docutils literal notranslate"><span class="pre">extract_band_value()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_calibration.html#spt3g.calibration.bolopropertiesutils.get_band_units"><code class="docutils literal notranslate"><span class="pre">get_band_units()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_calibration.html#spt3g.calibration.bolopropertiesutils.set_band_format"><code class="docutils literal notranslate"><span class="pre">set_band_format()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../moddoc_core.html">core</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../moddoc_core.html#api-documentation">API Documentation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../moddoc_core.html#frame-objects">Frame Objects</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3Bool"><code class="docutils literal notranslate"><span class="pre">G3Bool</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3Double"><code class="docutils literal notranslate"><span class="pre">G3Double</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3FrameObject"><code class="docutils literal notranslate"><span class="pre">G3FrameObject</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3Int"><code class="docutils literal notranslate"><span class="pre">G3Int</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3MapDouble"><code class="docutils literal notranslate"><span class="pre">G3MapDouble</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3MapFrameObject"><code class="docutils literal notranslate"><span class="pre">G3MapFrameObject</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3MapInt"><code class="docutils literal notranslate"><span class="pre">G3MapInt</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3MapMapDouble"><code class="docutils literal notranslate"><span class="pre">G3MapMapDouble</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3MapQuat"><code class="docutils literal notranslate"><span class="pre">G3MapQuat</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3MapString"><code class="docutils literal notranslate"><span class="pre">G3MapString</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3MapTime"><code class="docutils literal notranslate"><span class="pre">G3MapTime</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3MapVectorBool"><code class="docutils literal notranslate"><span class="pre">G3MapVectorBool</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3MapVectorComplexDouble"><code class="docutils literal notranslate"><span class="pre">G3MapVectorComplexDouble</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3MapVectorDouble"><code class="docutils literal notranslate"><span class="pre">G3MapVectorDouble</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3MapVectorInt"><code class="docutils literal notranslate"><span class="pre">G3MapVectorInt</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3MapVectorQuat"><code class="docutils literal notranslate"><span class="pre">G3MapVectorQuat</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3MapVectorString"><code class="docutils literal notranslate"><span class="pre">G3MapVectorString</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3MapVectorTime"><code class="docutils literal notranslate"><span class="pre">G3MapVectorTime</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3MapVectorVectorString"><code class="docutils literal notranslate"><span class="pre">G3MapVectorVectorString</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3ModuleConfig"><code class="docutils literal notranslate"><span class="pre">G3ModuleConfig</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3PipelineInfo"><code class="docutils literal notranslate"><span class="pre">G3PipelineInfo</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3Quat"><code class="docutils literal notranslate"><span class="pre">G3Quat</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3String"><code class="docutils literal notranslate"><span class="pre">G3String</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3Time"><code class="docutils literal notranslate"><span class="pre">G3Time</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3TimesampleMap"><code class="docutils literal notranslate"><span class="pre">G3TimesampleMap</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3Timestream"><code class="docutils literal notranslate"><span class="pre">G3Timestream</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3TimestreamMap"><code class="docutils literal notranslate"><span class="pre">G3TimestreamMap</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3TimestreamQuat"><code class="docutils literal notranslate"><span class="pre">G3TimestreamQuat</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3VectorBool"><code class="docutils literal notranslate"><span class="pre">G3VectorBool</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3VectorComplexDouble"><code class="docutils literal notranslate"><span class="pre">G3VectorComplexDouble</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3VectorDouble"><code class="docutils literal notranslate"><span class="pre">G3VectorDouble</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3VectorFrameObject"><code class="docutils literal notranslate"><span class="pre">G3VectorFrameObject</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3VectorInt"><code class="docutils literal notranslate"><span class="pre">G3VectorInt</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3VectorQuat"><code class="docutils literal notranslate"><span class="pre">G3VectorQuat</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3VectorString"><code class="docutils literal notranslate"><span class="pre">G3VectorString</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3VectorTime"><code class="docutils literal notranslate"><span class="pre">G3VectorTime</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3VectorUnsignedChar"><code class="docutils literal notranslate"><span class="pre">G3VectorUnsignedChar</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3VectorVectorString"><code class="docutils literal notranslate"><span class="pre">G3VectorVectorString</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../moddoc_core.html#class-like-pipeline-modules">Class-like Pipeline Modules</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3EventBuilder"><code class="docutils literal notranslate"><span class="pre">G3EventBuilder</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3InfiniteSource"><code class="docutils literal notranslate"><span class="pre">G3InfiniteSource</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3Module"><code class="docutils literal notranslate"><span class="pre">G3Module</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3MultiFileWriter"><code class="docutils literal notranslate"><span class="pre">G3MultiFileWriter</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3NetworkSender"><code class="docutils literal notranslate"><span class="pre">G3NetworkSender</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3Reader"><code class="docutils literal notranslate"><span class="pre">G3Reader</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3Writer"><code class="docutils literal notranslate"><span class="pre">G3Writer</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.util.AbortAfterNFrames"><code class="docutils literal notranslate"><span class="pre">AbortAfterNFrames</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.util.DeduplicateMetadata"><code class="docutils literal notranslate"><span class="pre">DeduplicateMetadata</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.util.DropOrphanMetadata"><code class="docutils literal notranslate"><span class="pre">DropOrphanMetadata</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.util.G3ThrottledNetworkSender"><code class="docutils literal notranslate"><span class="pre">G3ThrottledNetworkSender</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.util.InjectFrame"><code class="docutils literal notranslate"><span class="pre">InjectFrame</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../moddoc_core.html#function-like-pipeline-modules">Function-like Pipeline Modules</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.util.Delete"><code class="docutils literal notranslate"><span class="pre">Delete()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.util.Dump"><code class="docutils literal notranslate"><span class="pre">Dump()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.util.InjectDebug"><code class="docutils literal notranslate"><span class="pre">InjectDebug()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.util.Keep"><code class="docutils literal notranslate"><span class="pre">Keep()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.util.Rename"><code class="docutils literal notranslate"><span class="pre">Rename()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../moddoc_core.html#pipeline-segments">Pipeline Segments</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.util.G3NetworkReceiver"><code class="docutils literal notranslate"><span class="pre">G3NetworkReceiver()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../moddoc_core.html#useful-classes">Useful Classes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.BoolVector"><code class="docutils literal notranslate"><span class="pre">BoolVector</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.ComplexDoubleVector"><code class="docutils literal notranslate"><span class="pre">ComplexDoubleVector</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.ComplexFloatVector"><code class="docutils literal notranslate"><span class="pre">ComplexFloatVector</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.DoubleVector"><code class="docutils literal notranslate"><span class="pre">DoubleVector</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.FloatVector"><code class="docutils literal notranslate"><span class="pre">FloatVector</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.FrameObjectVector"><code class="docutils literal notranslate"><span class="pre">FrameObjectVector</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.FrameTypeVector"><code class="docutils literal notranslate"><span class="pre">FrameTypeVector</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.FrameVector"><code class="docutils literal notranslate"><span class="pre">FrameVector</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3Frame"><code class="docutils literal notranslate"><span class="pre">G3Frame</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3FrameType"><code class="docutils literal notranslate"><span class="pre">G3FrameType</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3LogLevel"><code class="docutils literal notranslate"><span class="pre">G3LogLevel</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3Logger"><code class="docutils literal notranslate"><span class="pre">G3Logger</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3LoggerVector"><code class="docutils literal notranslate"><span class="pre">G3LoggerVector</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3MultiLogger"><code class="docutils literal notranslate"><span class="pre">G3MultiLogger</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3NullLogger"><code class="docutils literal notranslate"><span class="pre">G3NullLogger</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3Pipeline"><code class="docutils literal notranslate"><span class="pre">G3Pipeline</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3PrintfLogger"><code class="docutils literal notranslate"><span class="pre">G3PrintfLogger</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3SyslogLogger"><code class="docutils literal notranslate"><span class="pre">G3SyslogLogger</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3TimeVector"><code class="docutils literal notranslate"><span class="pre">G3TimeVector</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3TimestreamUnits"><code class="docutils literal notranslate"><span class="pre">G3TimestreamUnits</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.G3VectorStringVector"><code class="docutils literal notranslate"><span class="pre">G3VectorStringVector</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.Int64Vector"><code class="docutils literal notranslate"><span class="pre">Int64Vector</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.IntVector"><code class="docutils literal notranslate"><span class="pre">IntVector</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.ItemsView"><code class="docutils literal notranslate"><span class="pre">ItemsView</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.KeysView"><code class="docutils literal notranslate"><span class="pre">KeysView</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.ModuleConfigVector"><code class="docutils literal notranslate"><span class="pre">ModuleConfigVector</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.Quat"><code class="docutils literal notranslate"><span class="pre">Quat</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.QuatVector"><code class="docutils literal notranslate"><span class="pre">QuatVector</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.StringVector"><code class="docutils literal notranslate"><span class="pre">StringVector</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.UInt64Vector"><code class="docutils literal notranslate"><span class="pre">UInt64Vector</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.UIntVector"><code class="docutils literal notranslate"><span class="pre">UIntVector</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.UnsignedCharVector"><code class="docutils literal notranslate"><span class="pre">UnsignedCharVector</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.ValuesView"><code class="docutils literal notranslate"><span class="pre">ValuesView</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.apidoc.G3Documenter"><code class="docutils literal notranslate"><span class="pre">G3Documenter</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.fileio.G3File"><code class="docutils literal notranslate"><span class="pre">G3File</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../moddoc_core.html#useful-functions">Useful Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.apidoc.module_apidoc"><code class="docutils literal notranslate"><span class="pre">module_apidoc()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.g3logging.log_debug"><code class="docutils literal notranslate"><span class="pre">log_debug()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.g3logging.log_error"><code class="docutils literal notranslate"><span class="pre">log_error()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.g3logging.log_fatal"><code class="docutils literal notranslate"><span class="pre">log_fatal()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.g3logging.log_info"><code class="docutils literal notranslate"><span class="pre">log_info()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.g3logging.log_notice"><code class="docutils literal notranslate"><span class="pre">log_notice()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.g3logging.log_trace"><code class="docutils literal notranslate"><span class="pre">log_trace()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.g3logging.log_warn"><code class="docutils literal notranslate"><span class="pre">log_warn()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.g3logging.set_log_level"><code class="docutils literal notranslate"><span class="pre">set_log_level()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.timestreamextensions.concatenate_timestreams"><code class="docutils literal notranslate"><span class="pre">concatenate_timestreams()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../moddoc_core.html#decorators">Decorators</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.g3decorators.cache_frame_data"><code class="docutils literal notranslate"><span class="pre">cache_frame_data()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.g3decorators.scan_func_cache_data"><code class="docutils literal notranslate"><span class="pre">scan_func_cache_data()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.modconstruct.indexmod"><code class="docutils literal notranslate"><span class="pre">indexmod()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.modconstruct.pipesegment"><code class="docutils literal notranslate"><span class="pre">pipesegment()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.modconstruct.pipesegment_nodoc"><code class="docutils literal notranslate"><span class="pre">pipesegment_nodoc()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_core.html#spt3g.core.modconstruct.usefulfunc"><code class="docutils literal notranslate"><span class="pre">usefulfunc()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../moddoc_dfmux.html">dfmux</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../moddoc_dfmux.html#api-documentation">API Documentation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../moddoc_dfmux.html#frame-objects">Frame Objects</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_dfmux.html#spt3g.dfmux.DfMuxBoardSamples"><code class="docutils literal notranslate"><span class="pre">DfMuxBoardSamples</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_dfmux.html#spt3g.dfmux.DfMuxChannelMapping"><code class="docutils literal notranslate"><span class="pre">DfMuxChannelMapping</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_dfmux.html#spt3g.dfmux.DfMuxHousekeepingMap"><code class="docutils literal notranslate"><span class="pre">DfMuxHousekeepingMap</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_dfmux.html#spt3g.dfmux.DfMuxMetaSample"><code class="docutils literal notranslate"><span class="pre">DfMuxMetaSample</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_dfmux.html#spt3g.dfmux.DfMuxSample"><code class="docutils literal notranslate"><span class="pre">DfMuxSample</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_dfmux.html#spt3g.dfmux.DfMuxWiringMap"><code class="docutils literal notranslate"><span class="pre">DfMuxWiringMap</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_dfmux.html#spt3g.dfmux.HkBoardInfo"><code class="docutils literal notranslate"><span class="pre">HkBoardInfo</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_dfmux.html#spt3g.dfmux.HkChannelInfo"><code class="docutils literal notranslate"><span class="pre">HkChannelInfo</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_dfmux.html#spt3g.dfmux.HkMezzanineInfo"><code class="docutils literal notranslate"><span class="pre">HkMezzanineInfo</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_dfmux.html#spt3g.dfmux.HkModuleInfo"><code class="docutils literal notranslate"><span class="pre">HkModuleInfo</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../moddoc_dfmux.html#class-like-pipeline-modules">Class-like Pipeline Modules</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_dfmux.html#spt3g.dfmux.DataQualityTools.FillMissingTimepointFrames"><code class="docutils literal notranslate"><span class="pre">FillMissingTimepointFrames</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_dfmux.html#spt3g.dfmux.DfMuxBuilder"><code class="docutils literal notranslate"><span class="pre">DfMuxBuilder</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_dfmux.html#spt3g.dfmux.DfMuxCollator"><code class="docutils literal notranslate"><span class="pre">DfMuxCollator</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_dfmux.html#spt3g.dfmux.HardwareMapTools.DfmlHardwareMapInjector"><code class="docutils literal notranslate"><span class="pre">DfmlHardwareMapInjector</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_dfmux.html#spt3g.dfmux.HardwareMapTools.GenerateFakeHardwareMap"><code class="docutils literal notranslate"><span class="pre">GenerateFakeHardwareMap</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_dfmux.html#spt3g.dfmux.HardwareMapTools.PyDfMuxWiringMapInjector"><code class="docutils literal notranslate"><span class="pre">PyDfMuxWiringMapInjector</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_dfmux.html#spt3g.dfmux.Housekeeping.HousekeepingConsumer"><code class="docutils literal notranslate"><span class="pre">HousekeepingConsumer</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_dfmux.html#spt3g.dfmux.Housekeeping.PeriodicHousekeepingCollector"><code class="docutils literal notranslate"><span class="pre">PeriodicHousekeepingCollector</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_dfmux.html#spt3g.dfmux.LegacyHousekeeping.LegacyHousekeepingConsumer"><code class="docutils literal notranslate"><span class="pre">LegacyHousekeepingConsumer</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_dfmux.html#spt3g.dfmux.NetCDFDump"><code class="docutils literal notranslate"><span class="pre">NetCDFDump</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_dfmux.html#spt3g.dfmux.ScanTools.FixedLengthScans"><code class="docutils literal notranslate"><span class="pre">FixedLengthScans</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_dfmux.html#spt3g.dfmux.unittransforms.ConvertTimestreamUnits"><code class="docutils literal notranslate"><span class="pre">ConvertTimestreamUnits</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../moddoc_dfmux.html#function-like-pipeline-modules">Function-like Pipeline Modules</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_dfmux.html#spt3g.dfmux.HardwareMapTools.PyDfMuxBolometerPropertiesInjector"><code class="docutils literal notranslate"><span class="pre">PyDfMuxBolometerPropertiesInjector()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../moddoc_dfmux.html#useful-classes">Useful Classes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_dfmux.html#spt3g.dfmux.DfMuxCollector"><code class="docutils literal notranslate"><span class="pre">DfMuxCollector</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_dfmux.html#spt3g.dfmux.HkChannelInfoMap"><code class="docutils literal notranslate"><span class="pre">HkChannelInfoMap</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_dfmux.html#spt3g.dfmux.HkMezzanineInfoMap"><code class="docutils literal notranslate"><span class="pre">HkMezzanineInfoMap</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_dfmux.html#spt3g.dfmux.HkModuleInfoMap"><code class="docutils literal notranslate"><span class="pre">HkModuleInfoMap</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_dfmux.html#spt3g.dfmux.LegacyDfMuxCollector"><code class="docutils literal notranslate"><span class="pre">LegacyDfMuxCollector</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../moddoc_dfmux.html#useful-functions">Useful Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_dfmux.html#spt3g.dfmux.HardwareMapTools.PathStringForBolo"><code class="docutils literal notranslate"><span class="pre">PathStringForBolo()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_dfmux.html#spt3g.dfmux.Housekeeping.HousekeepingForBolo"><code class="docutils literal notranslate"><span class="pre">HousekeepingForBolo()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_dfmux.html#spt3g.dfmux.unittransforms.get_timestream_unit_conversion"><code class="docutils literal notranslate"><span class="pre">get_timestream_unit_conversion()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../moddoc_gcp.html">gcp</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../moddoc_gcp.html#api-documentation">API Documentation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../moddoc_gcp.html#frame-objects">Frame Objects</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_gcp.html#spt3g.gcp.ACUStatus"><code class="docutils literal notranslate"><span class="pre">ACUStatus</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_gcp.html#spt3g.gcp.ACUStatusVector"><code class="docutils literal notranslate"><span class="pre">ACUStatusVector</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_gcp.html#spt3g.gcp.TrackerPointing"><code class="docutils literal notranslate"><span class="pre">TrackerPointing</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_gcp.html#spt3g.gcp.TrackerStatus"><code class="docutils literal notranslate"><span class="pre">TrackerStatus</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../moddoc_gcp.html#class-like-pipeline-modules">Class-like Pipeline Modules</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_gcp.html#spt3g.gcp.ARCExtractor.CalibrateFrame"><code class="docutils literal notranslate"><span class="pre">CalibrateFrame</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_gcp.html#spt3g.gcp.ARCFileReader"><code class="docutils literal notranslate"><span class="pre">ARCFileReader</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_gcp.html#spt3g.gcp.ARCHKExtractor.UnpackSPTpolHKData"><code class="docutils literal notranslate"><span class="pre">UnpackSPTpolHKData</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_gcp.html#spt3g.gcp.GCPDataTee.DAQWatchdog"><code class="docutils literal notranslate"><span class="pre">DAQWatchdog</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_gcp.html#spt3g.gcp.GCPDataTee.GCPBoloDataTee"><code class="docutils literal notranslate"><span class="pre">GCPBoloDataTee</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_gcp.html#spt3g.gcp.GCPDataTee.GCPHousekeepingTee"><code class="docutils literal notranslate"><span class="pre">GCPHousekeepingTee</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_gcp.html#spt3g.gcp.GCPDataTee.GCPSignalledHousekeeping"><code class="docutils literal notranslate"><span class="pre">GCPSignalledHousekeeping</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_gcp.html#spt3g.gcp.GCPDataTee.PagerWatchdog"><code class="docutils literal notranslate"><span class="pre">PagerWatchdog</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_gcp.html#spt3g.gcp.GCPMuxDataDecoder"><code class="docutils literal notranslate"><span class="pre">GCPMuxDataDecoder</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../moddoc_gcp.html#function-like-pipeline-modules">Function-like Pipeline Modules</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_gcp.html#spt3g.gcp.ARCExtractor.AddBenchData"><code class="docutils literal notranslate"><span class="pre">AddBenchData()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_gcp.html#spt3g.gcp.ARCExtractor.DecryptFeatureBit"><code class="docutils literal notranslate"><span class="pre">DecryptFeatureBit()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_gcp.html#spt3g.gcp.ARCExtractor.UnpackACUData"><code class="docutils literal notranslate"><span class="pre">UnpackACUData()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_gcp.html#spt3g.gcp.ARCExtractor.UnpackCryoData"><code class="docutils literal notranslate"><span class="pre">UnpackCryoData()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_gcp.html#spt3g.gcp.ARCExtractor.UnpackMuxData"><code class="docutils literal notranslate"><span class="pre">UnpackMuxData()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_gcp.html#spt3g.gcp.ARCExtractor.UnpackPTData"><code class="docutils literal notranslate"><span class="pre">UnpackPTData()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_gcp.html#spt3g.gcp.ARCExtractor.UnpackTrackerData"><code class="docutils literal notranslate"><span class="pre">UnpackTrackerData()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_gcp.html#spt3g.gcp.ARCExtractor.UnpackTrackerMinimal"><code class="docutils literal notranslate"><span class="pre">UnpackTrackerMinimal()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_gcp.html#spt3g.gcp.ARCExtractor.UnpackTrackerPointingData"><code class="docutils literal notranslate"><span class="pre">UnpackTrackerPointingData()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_gcp.html#spt3g.gcp.ARCExtractor.UnpackWeatherData"><code class="docutils literal notranslate"><span class="pre">UnpackWeatherData()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_gcp.html#spt3g.gcp.ARCExtractor.UpdateLinearSensorDeltas"><code class="docutils literal notranslate"><span class="pre">UpdateLinearSensorDeltas()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_gcp.html#spt3g.gcp.InfluxDB.WriteDB"><code class="docutils literal notranslate"><span class="pre">WriteDB()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../moddoc_gcp.html#pipeline-segments">Pipeline Segments</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_gcp.html#spt3g.gcp.ARCExtractor.ARCExtract"><code class="docutils literal notranslate"><span class="pre">ARCExtract()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_gcp.html#spt3g.gcp.ARCExtractor.ARCExtractMinimal"><code class="docutils literal notranslate"><span class="pre">ARCExtractMinimal()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_gcp.html#spt3g.gcp.InfluxDB.UpdateDB"><code class="docutils literal notranslate"><span class="pre">UpdateDB()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../moddoc_gcp.html#useful-classes">Useful Classes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_gcp.html#spt3g.gcp.ACUState"><code class="docutils literal notranslate"><span class="pre">ACUState</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_gcp.html#spt3g.gcp.ARCFile.ARCFile"><code class="docutils literal notranslate"><span class="pre">ARCFile</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_gcp.html#spt3g.gcp.CalFile.CalFileReader"><code class="docutils literal notranslate"><span class="pre">CalFileReader</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_gcp.html#spt3g.gcp.Experiment"><code class="docutils literal notranslate"><span class="pre">Experiment</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_gcp.html#spt3g.gcp.GCPLogger"><code class="docutils literal notranslate"><span class="pre">GCPLogger</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_gcp.html#spt3g.gcp.TrackerState"><code class="docutils literal notranslate"><span class="pre">TrackerState</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_gcp.html#spt3g.gcp.TrackerStateVector"><code class="docutils literal notranslate"><span class="pre">TrackerStateVector</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../moddoc_gcp.html#useful-functions">Useful Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_gcp.html#spt3g.gcp.CalFile.create_g3_cal_file"><code class="docutils literal notranslate"><span class="pre">create_g3_cal_file()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../moddoc_maps.html">maps</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../moddoc_maps.html#map-attributes">Map Attributes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../moddoc_maps.html#file-format-conversions">File Format Conversions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../moddoc_maps.html#indexing">Indexing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../moddoc_maps.html#sparsity">Sparsity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../moddoc_maps.html#masking">Masking</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../moddoc_maps.html#mask-memory-usage">Mask Memory Usage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../moddoc_maps.html#statistics">Statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../moddoc_maps.html#map-interpolation">Map Interpolation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../moddoc_maps.html#map-weights">Map Weights</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../moddoc_maps.html#map-frames-and-pipelines">Map Frames and Pipelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../moddoc_maps.html#flat-sky-map-projections">Flat Sky Map Projections</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../moddoc_maps.html#flat-sky-map-manipulation">Flat Sky Map Manipulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../moddoc_maps.html#map-pointing">Map Pointing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../moddoc_maps.html#pointing-quaternions">Pointing Quaternions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../moddoc_maps.html#rotation-quaternions">Rotation Quaternions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../moddoc_maps.html#detector-pointing">Detector Pointing</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../moddoc_maps.html#api-documentation">API Documentation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../moddoc_maps.html#frame-objects">Frame Objects</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.FlatSkyMap"><code class="docutils literal notranslate"><span class="pre">FlatSkyMap</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.G3SkyMapMask"><code class="docutils literal notranslate"><span class="pre">G3SkyMapMask</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.G3SkyMapWeights"><code class="docutils literal notranslate"><span class="pre">G3SkyMapWeights</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.HealpixSkyMap"><code class="docutils literal notranslate"><span class="pre">HealpixSkyMap</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../moddoc_maps.html#class-like-pipeline-modules">Class-like Pipeline Modules</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.HitsBinner"><code class="docutils literal notranslate"><span class="pre">HitsBinner</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.MapBinner"><code class="docutils literal notranslate"><span class="pre">MapBinner</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.MapMockObserver"><code class="docutils literal notranslate"><span class="pre">MapMockObserver</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.MapTODMasker"><code class="docutils literal notranslate"><span class="pre">MapTODMasker</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.MapTODPointing"><code class="docutils literal notranslate"><span class="pre">MapTODPointing</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.SingleDetectorBoresightBinner"><code class="docutils literal notranslate"><span class="pre">SingleDetectorBoresightBinner</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.SingleDetectorMapBinner"><code class="docutils literal notranslate"><span class="pre">SingleDetectorMapBinner</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.map_modules.CoaddMaps"><code class="docutils literal notranslate"><span class="pre">CoaddMaps</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.map_modules.ExtractMaps"><code class="docutils literal notranslate"><span class="pre">ExtractMaps</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.map_modules.InjectMapStub"><code class="docutils literal notranslate"><span class="pre">InjectMapStub</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.map_modules.InjectMaps"><code class="docutils literal notranslate"><span class="pre">InjectMaps</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.map_modules.InvertAlternatingMaps"><code class="docutils literal notranslate"><span class="pre">InvertAlternatingMaps</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.map_modules.ReprojectMaps"><code class="docutils literal notranslate"><span class="pre">ReprojectMaps</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../moddoc_maps.html#function-like-pipeline-modules">Function-like Pipeline Modules</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.azel.EquatorialToGalacticPointing"><code class="docutils literal notranslate"><span class="pre">EquatorialToGalacticPointing()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.azel.LocalToAstronomicalPointing"><code class="docutils literal notranslate"><span class="pre">LocalToAstronomicalPointing()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.coordsysmodules.AddLocalTransRotations"><code class="docutils literal notranslate"><span class="pre">AddLocalTransRotations()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.coordsysmodules.EquatorialToGalacticTransRotations"><code class="docutils literal notranslate"><span class="pre">EquatorialToGalacticTransRotations()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.coordsysmodules.FillCoordTransRotations"><code class="docutils literal notranslate"><span class="pre">FillCoordTransRotations()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.fitsio.SaveMapFrame"><code class="docutils literal notranslate"><span class="pre">SaveMapFrame()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.map_modules.ApplyWeights"><code class="docutils literal notranslate"><span class="pre">ApplyWeights()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.map_modules.CompactMaps"><code class="docutils literal notranslate"><span class="pre">CompactMaps()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.map_modules.FlattenPol"><code class="docutils literal notranslate"><span class="pre">FlattenPol()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.map_modules.InvertMaps"><code class="docutils literal notranslate"><span class="pre">InvertMaps()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.map_modules.MakeMapsPolarized"><code class="docutils literal notranslate"><span class="pre">MakeMapsPolarized()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.map_modules.MakeMapsUnpolarized"><code class="docutils literal notranslate"><span class="pre">MakeMapsUnpolarized()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.map_modules.RebinMaps"><code class="docutils literal notranslate"><span class="pre">RebinMaps()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.map_modules.RemoveWeights"><code class="docutils literal notranslate"><span class="pre">RemoveWeights()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.map_modules.ReplicateMaps"><code class="docutils literal notranslate"><span class="pre">ReplicateMaps()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.map_modules.RescaleMaps"><code class="docutils literal notranslate"><span class="pre">RescaleMaps()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.map_modules.SetPolConv"><code class="docutils literal notranslate"><span class="pre">SetPolConv()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.map_modules.ValidateMaps"><code class="docutils literal notranslate"><span class="pre">ValidateMaps()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.quathelpers.AddTimingToPointingQuats"><code class="docutils literal notranslate"><span class="pre">AddTimingToPointingQuats()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../moddoc_maps.html#useful-classes">Useful Classes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.G3SkyMap"><code class="docutils literal notranslate"><span class="pre">G3SkyMap</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.MapCoordReference"><code class="docutils literal notranslate"><span class="pre">MapCoordReference</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.MapPolConv"><code class="docutils literal notranslate"><span class="pre">MapPolConv</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.MapPolType"><code class="docutils literal notranslate"><span class="pre">MapPolType</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.MapProjection"><code class="docutils literal notranslate"><span class="pre">MapProjection</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../moddoc_maps.html#useful-functions">Useful Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.apply_weights"><code class="docutils literal notranslate"><span class="pre">apply_weights()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.apply_weights_t"><code class="docutils literal notranslate"><span class="pre">apply_weights_t()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.azel.convert_azel_to_radec"><code class="docutils literal notranslate"><span class="pre">convert_azel_to_radec()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.azel.convert_gal_to_radec"><code class="docutils literal notranslate"><span class="pre">convert_gal_to_radec()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.azel.convert_radec_to_azel"><code class="docutils literal notranslate"><span class="pre">convert_radec_to_azel()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.azel.convert_radec_to_gal"><code class="docutils literal notranslate"><span class="pre">convert_radec_to_gal()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.convolve_map"><code class="docutils literal notranslate"><span class="pre">convolve_map()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.fitsio.load_skymap_fits"><code class="docutils literal notranslate"><span class="pre">load_skymap_fits()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.fitsio.load_skymapmask_fits"><code class="docutils literal notranslate"><span class="pre">load_skymapmask_fits()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.fitsio.save_skymap_fits"><code class="docutils literal notranslate"><span class="pre">save_skymap_fits()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.fitsio.save_skymapmask_fits"><code class="docutils literal notranslate"><span class="pre">save_skymapmask_fits()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.flatten_pol"><code class="docutils literal notranslate"><span class="pre">flatten_pol()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.get_boresight_rotator_timestream"><code class="docutils literal notranslate"><span class="pre">get_boresight_rotator_timestream()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.get_detector_pointing"><code class="docutils literal notranslate"><span class="pre">get_detector_pointing()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.get_detector_pointing_quats"><code class="docutils literal notranslate"><span class="pre">get_detector_pointing_quats()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.get_fk5_j2000_to_gal_quat"><code class="docutils literal notranslate"><span class="pre">get_fk5_j2000_to_gal_quat()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.get_galactic_plane_mask"><code class="docutils literal notranslate"><span class="pre">get_galactic_plane_mask()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.get_map_hist"><code class="docutils literal notranslate"><span class="pre">get_map_hist()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.get_map_moments"><code class="docutils literal notranslate"><span class="pre">get_map_moments()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.get_origin_rotator"><code class="docutils literal notranslate"><span class="pre">get_origin_rotator()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.get_origin_rotator_timestream"><code class="docutils literal notranslate"><span class="pre">get_origin_rotator_timestream()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.get_ra_dec_map"><code class="docutils literal notranslate"><span class="pre">get_ra_dec_map()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.get_ra_dec_mask"><code class="docutils literal notranslate"><span class="pre">get_ra_dec_mask()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.get_rot_ang"><code class="docutils literal notranslate"><span class="pre">get_rot_ang()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.get_transform_quat"><code class="docutils literal notranslate"><span class="pre">get_transform_quat()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.make_point_source_mask"><code class="docutils literal notranslate"><span class="pre">make_point_source_mask()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.map_modules.coadd_map_files"><code class="docutils literal notranslate"><span class="pre">coadd_map_files()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.maputils.flatsky_to_healpix"><code class="docutils literal notranslate"><span class="pre">flatsky_to_healpix()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.maputils.healpix_to_flatsky"><code class="docutils literal notranslate"><span class="pre">healpix_to_flatsky()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.offsets_to_quat"><code class="docutils literal notranslate"><span class="pre">offsets_to_quat()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.quathelpers.ang_to_quat"><code class="docutils literal notranslate"><span class="pre">ang_to_quat()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.quathelpers.quat_to_ang"><code class="docutils literal notranslate"><span class="pre">quat_to_ang()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.remove_weights"><code class="docutils literal notranslate"><span class="pre">remove_weights()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.remove_weights_t"><code class="docutils literal notranslate"><span class="pre">remove_weights_t()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_maps.html#spt3g.maps.reproj_map"><code class="docutils literal notranslate"><span class="pre">reproj_map()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../moddoc_mpi.html">mpi</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../moddoc_mpi.html#frame-io-parallelization">Frame IO Parallelization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../moddoc_mpi.html#frame-accumulation">Frame Accumulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../moddoc_mpi.html#interface-to-toast">Interface to TOAST</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../moddoc_mpi.html#api-documentation">API Documentation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../moddoc_mpi.html#class-like-pipeline-modules">Class-like Pipeline Modules</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_mpi.html#spt3g.mpi.MPIAccumulator.MPIAccumulator"><code class="docutils literal notranslate"><span class="pre">MPIAccumulator</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_mpi.html#spt3g.mpi.MPIFileIO.MPIFileReader"><code class="docutils literal notranslate"><span class="pre">MPIFileReader</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_mpi.html#spt3g.mpi.MPIFileIO.MPIFrameParallelizer"><code class="docutils literal notranslate"><span class="pre">MPIFrameParallelizer</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../moddoc_mpi.html#pipeline-segments">Pipeline Segments</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../moddoc_mpi.html#spt3g.mpi.MPIFileIO.MPIIODistributor"><code class="docutils literal notranslate"><span class="pre">MPIIODistributor()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">SPT-3G Software</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">spt3g.maps.map_modules</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for spt3g.maps.map_modules</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">core</span><span class="p">,</span> <span class="n">maps</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;CompactMaps&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RemoveWeights&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ApplyWeights&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SetPolConv&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FlattenPol&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MakeMapsPolarized&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MakeMapsUnpolarized&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ValidateMaps&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ExtractMaps&quot;</span><span class="p">,</span>
    <span class="s2">&quot;InjectMapStub&quot;</span><span class="p">,</span>
    <span class="s2">&quot;InjectMaps&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ReplicateMaps&quot;</span><span class="p">,</span>
    <span class="s2">&quot;InvertMaps&quot;</span><span class="p">,</span>
    <span class="s2">&quot;InvertAlternatingMaps&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RescaleMaps&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CoaddMaps&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RebinMaps&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ReprojectMaps&quot;</span><span class="p">,</span>
    <span class="s2">&quot;coadd_map_files&quot;</span><span class="p">,</span>
<span class="p">]</span>


<div class="viewcode-block" id="CompactMaps">
<a class="viewcode-back" href="../../../moddoc_maps.html#spt3g.maps.map_modules.CompactMaps">[docs]</a>
<span class="nd">@core</span><span class="o">.</span><span class="n">indexmod</span>
<span class="k">def</span> <span class="nf">CompactMaps</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">zero_nans</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compact all maps in a frame to their default sparse representation.</span>
<span class="sd">    Optionally remove NaN values as well.  Removing NaN values will reduce</span>
<span class="sd">    memory use, but will remove the distinction in unweighted (or</span>
<span class="sd">    weight-removed) maps between unobserved regions and regions with zero</span>
<span class="sd">    temperature.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="s2">&quot;U&quot;</span><span class="p">,</span> <span class="s2">&quot;Wunpol&quot;</span><span class="p">,</span> <span class="s2">&quot;Wpol&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">frame</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="n">m</span><span class="o">.</span><span class="n">compact</span><span class="p">(</span><span class="n">zero_nans</span><span class="o">=</span><span class="n">zero_nans</span><span class="p">)</span>
            <span class="n">frame</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span>
    <span class="k">return</span> <span class="n">frame</span></div>



<div class="viewcode-block" id="RemoveWeights">
<a class="viewcode-back" href="../../../moddoc_maps.html#spt3g.maps.map_modules.RemoveWeights">[docs]</a>
<span class="nd">@core</span><span class="o">.</span><span class="n">indexmod</span>
<span class="k">def</span> <span class="nf">RemoveWeights</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">zero_nans</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Remove weights from input maps.  If zero_nans is `True`, empty pixels are</span>
<span class="sd">    skipped and pixels with zero weight are set to 0 instead of NaN.  Operation</span>
<span class="sd">    is performed in place to minimize memory use.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;Wpol&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">frame</span> <span class="ow">and</span> <span class="s2">&quot;Wunpol&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">frame</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">frame</span><span class="p">[</span><span class="s2">&quot;T&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">weighted</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">frame</span>
    <span class="n">ValidateMaps</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

    <span class="n">tmap</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;Wpol&quot;</span> <span class="ow">in</span> <span class="n">frame</span><span class="p">:</span>
        <span class="n">wmap</span> <span class="o">=</span> <span class="n">frame</span><span class="p">[</span><span class="s2">&quot;Wpol&quot;</span><span class="p">]</span>
        <span class="n">qmap</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;Q&quot;</span><span class="p">)</span>
        <span class="n">umap</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;U&quot;</span><span class="p">)</span>
        <span class="n">maps</span><span class="o">.</span><span class="n">remove_weights</span><span class="p">(</span><span class="n">tmap</span><span class="p">,</span> <span class="n">qmap</span><span class="p">,</span> <span class="n">umap</span><span class="p">,</span> <span class="n">wmap</span><span class="p">,</span> <span class="n">zero_nans</span><span class="o">=</span><span class="n">zero_nans</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">wmap</span> <span class="o">=</span> <span class="n">frame</span><span class="p">[</span><span class="s2">&quot;Wunpol&quot;</span><span class="p">]</span>
        <span class="n">maps</span><span class="o">.</span><span class="n">remove_weights_t</span><span class="p">(</span><span class="n">tmap</span><span class="p">,</span> <span class="n">wmap</span><span class="p">,</span> <span class="n">zero_nans</span><span class="o">=</span><span class="n">zero_nans</span><span class="p">)</span>

    <span class="n">frame</span><span class="p">[</span><span class="s2">&quot;T&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmap</span>
    <span class="k">if</span> <span class="s2">&quot;Wpol&quot;</span> <span class="ow">in</span> <span class="n">frame</span><span class="p">:</span>
        <span class="n">frame</span><span class="p">[</span><span class="s2">&quot;Q&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">qmap</span>
        <span class="n">frame</span><span class="p">[</span><span class="s2">&quot;U&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">umap</span>

    <span class="k">return</span> <span class="n">frame</span></div>



<div class="viewcode-block" id="ApplyWeights">
<a class="viewcode-back" href="../../../moddoc_maps.html#spt3g.maps.map_modules.ApplyWeights">[docs]</a>
<span class="nd">@core</span><span class="o">.</span><span class="n">indexmod</span>
<span class="k">def</span> <span class="nf">ApplyWeights</span><span class="p">(</span><span class="n">frame</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Apply weights to the input maps.  The operation is performed in place to</span>
<span class="sd">    minimize memory use.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;Wpol&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">frame</span> <span class="ow">and</span> <span class="s2">&quot;Wunpol&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">frame</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="n">frame</span><span class="p">[</span><span class="s2">&quot;T&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">weighted</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">frame</span>
    <span class="n">ValidateMaps</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

    <span class="n">tmap</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;Wpol&quot;</span> <span class="ow">in</span> <span class="n">frame</span><span class="p">:</span>
        <span class="n">wmap</span> <span class="o">=</span> <span class="n">frame</span><span class="p">[</span><span class="s2">&quot;Wpol&quot;</span><span class="p">]</span>
        <span class="n">qmap</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;Q&quot;</span><span class="p">)</span>
        <span class="n">umap</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;U&quot;</span><span class="p">)</span>
        <span class="n">maps</span><span class="o">.</span><span class="n">apply_weights</span><span class="p">(</span><span class="n">tmap</span><span class="p">,</span> <span class="n">qmap</span><span class="p">,</span> <span class="n">umap</span><span class="p">,</span> <span class="n">wmap</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">wmap</span> <span class="o">=</span> <span class="n">frame</span><span class="p">[</span><span class="s2">&quot;Wunpol&quot;</span><span class="p">]</span>
        <span class="n">maps</span><span class="o">.</span><span class="n">apply_weights_t</span><span class="p">(</span><span class="n">tmap</span><span class="p">,</span> <span class="n">wmap</span><span class="p">)</span>

    <span class="n">frame</span><span class="p">[</span><span class="s2">&quot;T&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmap</span>
    <span class="k">if</span> <span class="s2">&quot;Wpol&quot;</span> <span class="ow">in</span> <span class="n">frame</span><span class="p">:</span>
        <span class="n">frame</span><span class="p">[</span><span class="s2">&quot;Q&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">qmap</span>
        <span class="n">frame</span><span class="p">[</span><span class="s2">&quot;U&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">umap</span>

    <span class="k">return</span> <span class="n">frame</span></div>



<div class="viewcode-block" id="SetPolConv">
<a class="viewcode-back" href="../../../moddoc_maps.html#spt3g.maps.map_modules.SetPolConv">[docs]</a>
<span class="nd">@core</span><span class="o">.</span><span class="n">indexmod</span>
<span class="k">def</span> <span class="nf">SetPolConv</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">pol_conv</span><span class="o">=</span><span class="n">maps</span><span class="o">.</span><span class="n">MapPolConv</span><span class="o">.</span><span class="n">IAU</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set or change the polarization convention of the input polarized map frame.</span>
<span class="sd">    If switching between IAU and COSMO conventions, flip the sign of the U map</span>
<span class="sd">    and the TU and QU weights.  Otherwise, just set the polarization convention</span>
<span class="sd">    for all maps and weights.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="s2">&quot;Q&quot;</span> <span class="ow">in</span> <span class="n">frame</span> <span class="ow">and</span> <span class="s2">&quot;U&quot;</span> <span class="ow">in</span> <span class="n">frame</span><span class="p">):</span>
        <span class="c1"># only polarized frames</span>
        <span class="k">return</span> <span class="n">frame</span>

    <span class="k">if</span> <span class="n">pol_conv</span> <span class="o">==</span> <span class="n">maps</span><span class="o">.</span><span class="n">MapPolConv</span><span class="o">.</span><span class="n">none</span> <span class="ow">or</span> <span class="n">pol_conv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Polarized maps must have pol_conv set to IAU or COSMO&quot;</span><span class="p">)</span>

    <span class="n">tmap</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span>
    <span class="n">tmap</span><span class="o">.</span><span class="n">pol_conv</span> <span class="o">=</span> <span class="n">pol_conv</span>

    <span class="n">qmap</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;Q&quot;</span><span class="p">)</span>
    <span class="n">qmap</span><span class="o">.</span><span class="n">pol_conv</span> <span class="o">=</span> <span class="n">pol_conv</span>

    <span class="n">umap</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;U&quot;</span><span class="p">)</span>
    <span class="n">flip</span> <span class="o">=</span> <span class="n">umap</span><span class="o">.</span><span class="n">polarized</span> <span class="ow">and</span> <span class="n">umap</span><span class="o">.</span><span class="n">pol_conv</span> <span class="o">!=</span> <span class="n">pol_conv</span>
    <span class="n">umap</span><span class="o">.</span><span class="n">pol_conv</span> <span class="o">=</span> <span class="n">pol_conv</span>

    <span class="n">wmap</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="s2">&quot;Wpol&quot;</span> <span class="ow">in</span> <span class="n">frame</span><span class="p">:</span>
        <span class="n">wmap</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;Wpol&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">wmap</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">wmap</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">pol_conv</span> <span class="o">=</span> <span class="n">pol_conv</span>

    <span class="c1"># flip sign if switching conventions</span>
    <span class="k">if</span> <span class="n">flip</span><span class="p">:</span>
        <span class="n">umap</span> <span class="o">*=</span> <span class="o">-</span><span class="mf">1.0</span>
        <span class="k">if</span> <span class="n">wmap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">wmap</span><span class="o">.</span><span class="n">TU</span> <span class="o">*=</span> <span class="o">-</span><span class="mf">1.0</span>
            <span class="n">wmap</span><span class="o">.</span><span class="n">QU</span> <span class="o">*=</span> <span class="o">-</span><span class="mf">1.0</span>

    <span class="n">frame</span><span class="p">[</span><span class="s2">&quot;T&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmap</span>
    <span class="n">frame</span><span class="p">[</span><span class="s2">&quot;Q&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">qmap</span>
    <span class="n">frame</span><span class="p">[</span><span class="s2">&quot;U&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">umap</span>
    <span class="k">if</span> <span class="n">wmap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">frame</span><span class="p">[</span><span class="s2">&quot;Wpol&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wmap</span>

    <span class="k">return</span> <span class="n">frame</span></div>



<div class="viewcode-block" id="FlattenPol">
<a class="viewcode-back" href="../../../moddoc_maps.html#spt3g.maps.map_modules.FlattenPol">[docs]</a>
<span class="nd">@core</span><span class="o">.</span><span class="n">indexmod</span>
<span class="k">def</span> <span class="nf">FlattenPol</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">invert</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    For maps defined on the sphere the direction of the polarization angle is</span>
<span class="sd">    is defined relative to the direction of North.  When making maps we follow</span>
<span class="sd">    this definition.</span>

<span class="sd">    For any flat sky estimators, the polarization angle is defined relative to</span>
<span class="sd">    the vertical axis.  For some map projections the direction of north is not</span>
<span class="sd">    the same as the vertical axis.  This function applies a rotation to the Q</span>
<span class="sd">    and U values to switch the curved sky Q/U definition to the flat sky Q/U</span>
<span class="sd">    definition.</span>

<span class="sd">    If for whatever reason you want to reverse the process set the invert</span>
<span class="sd">    argument to True.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="s2">&quot;Q&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">frame</span> <span class="ow">or</span> <span class="s2">&quot;U&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">frame</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">frame</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">maps</span><span class="o">.</span><span class="n">FlatSkyMap</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="s2">&quot;QU&quot;</span><span class="p">):</span>
        <span class="k">return</span>

    <span class="n">ValidateMaps</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">ignore_missing_weights</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">tmap</span><span class="p">,</span> <span class="n">qmap</span><span class="p">,</span> <span class="n">umap</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">),</span> <span class="n">frame</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;Q&quot;</span><span class="p">),</span> <span class="n">frame</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;U&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;Wpol&quot;</span> <span class="ow">in</span> <span class="n">frame</span><span class="p">:</span>
        <span class="n">wmap</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;Wpol&quot;</span><span class="p">)</span>
        <span class="n">maps</span><span class="o">.</span><span class="n">flatten_pol</span><span class="p">(</span><span class="n">qmap</span><span class="p">,</span> <span class="n">umap</span><span class="p">,</span> <span class="n">wmap</span><span class="p">,</span> <span class="n">invert</span><span class="o">=</span><span class="n">invert</span><span class="p">)</span>
        <span class="n">frame</span><span class="p">[</span><span class="s2">&quot;Wpol&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wmap</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">maps</span><span class="o">.</span><span class="n">flatten_pol</span><span class="p">(</span><span class="n">qmap</span><span class="p">,</span> <span class="n">umap</span><span class="p">,</span> <span class="n">invert</span><span class="o">=</span><span class="n">invert</span><span class="p">)</span>

    <span class="n">tmap</span><span class="o">.</span><span class="n">flat_pol</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">invert</span>
    
    <span class="n">frame</span><span class="p">[</span><span class="s2">&quot;T&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmap</span>
    <span class="n">frame</span><span class="p">[</span><span class="s2">&quot;Q&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">qmap</span>
    <span class="n">frame</span><span class="p">[</span><span class="s2">&quot;U&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">umap</span>

    <span class="k">return</span> <span class="n">frame</span></div>



<div class="viewcode-block" id="MakeMapsPolarized">
<a class="viewcode-back" href="../../../moddoc_maps.html#spt3g.maps.map_modules.MakeMapsPolarized">[docs]</a>
<span class="nd">@core</span><span class="o">.</span><span class="n">indexmod</span>
<span class="k">def</span> <span class="nf">MakeMapsPolarized</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">pol_conv</span><span class="o">=</span><span class="n">maps</span><span class="o">.</span><span class="n">MapPolConv</span><span class="o">.</span><span class="n">IAU</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts individual unpolarized maps to polarized versions of the same map,</span>
<span class="sd">    with the given polarization convention</span>

<span class="sd">    This module is only a shim that creates null Q and U maps and populates</span>
<span class="sd">    a properly invertible Wpol array from the TT Wunpol weights.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;Wunpol&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">frame</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="n">wgt</span> <span class="o">=</span> <span class="n">frame</span><span class="p">[</span><span class="s2">&quot;Wunpol&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">TT</span>
    <span class="n">wgt</span><span class="o">.</span><span class="n">pol_conv</span> <span class="o">=</span> <span class="n">pol_conv</span>
    <span class="k">del</span> <span class="n">frame</span><span class="p">[</span><span class="s2">&quot;Wunpol&quot;</span><span class="p">]</span>

    <span class="n">qmap</span> <span class="o">=</span> <span class="n">frame</span><span class="p">[</span><span class="s2">&quot;T&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">qmap</span><span class="o">.</span><span class="n">pol_type</span> <span class="o">=</span> <span class="n">maps</span><span class="o">.</span><span class="n">MapPolType</span><span class="o">.</span><span class="n">Q</span>
    <span class="n">qmap</span><span class="o">.</span><span class="n">pol_conv</span> <span class="o">=</span> <span class="n">pol_conv</span>
    <span class="n">frame</span><span class="p">[</span><span class="s2">&quot;Q&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">qmap</span>
    <span class="n">umap</span> <span class="o">=</span> <span class="n">frame</span><span class="p">[</span><span class="s2">&quot;T&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">umap</span><span class="o">.</span><span class="n">pol_type</span> <span class="o">=</span> <span class="n">maps</span><span class="o">.</span><span class="n">MapPolType</span><span class="o">.</span><span class="n">U</span>
    <span class="n">umap</span><span class="o">.</span><span class="n">pol_conv</span> <span class="o">=</span> <span class="n">pol_conv</span>
    <span class="n">frame</span><span class="p">[</span><span class="s2">&quot;U&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">umap</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">wgt</span><span class="o">.</span><span class="n">to_mask</span><span class="p">()</span><span class="o">.</span><span class="n">to_map</span><span class="p">()</span>

    <span class="n">wgt_out</span> <span class="o">=</span> <span class="n">maps</span><span class="o">.</span><span class="n">G3SkyMapWeights</span><span class="p">()</span>
    <span class="n">wgt_out</span><span class="o">.</span><span class="n">TT</span> <span class="o">=</span> <span class="n">wgt</span>
    <span class="n">wgt_out</span><span class="o">.</span><span class="n">TQ</span> <span class="o">=</span> <span class="n">wgt</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">wgt_out</span><span class="o">.</span><span class="n">TU</span> <span class="o">=</span> <span class="n">wgt</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">wgt_out</span><span class="o">.</span><span class="n">QQ</span> <span class="o">=</span> <span class="n">mask</span>
    <span class="n">wgt_out</span><span class="o">.</span><span class="n">QU</span> <span class="o">=</span> <span class="n">wgt</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">wgt_out</span><span class="o">.</span><span class="n">UU</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">wgt_out</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">wgt_out</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">pol_type</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">maps</span><span class="o">.</span><span class="n">MapPolType</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>

    <span class="n">frame</span><span class="p">[</span><span class="s2">&quot;Wpol&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wgt_out</span>

    <span class="k">return</span> <span class="n">frame</span></div>



<div class="viewcode-block" id="MakeMapsUnpolarized">
<a class="viewcode-back" href="../../../moddoc_maps.html#spt3g.maps.map_modules.MakeMapsUnpolarized">[docs]</a>
<span class="nd">@core</span><span class="o">.</span><span class="n">indexmod</span>
<span class="k">def</span> <span class="nf">MakeMapsUnpolarized</span><span class="p">(</span><span class="n">frame</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts individual polarized maps to temperature-only versions of the same map.</span>

<span class="sd">    This is done by simply dropping the Q and U Stokes terms from the input frame.</span>
<span class="sd">    To ensure that the resulting T component is free of polarization, use the</span>
<span class="sd">    ``RemoveWeights`` pipeline module before this module.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;Wpol&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">frame</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="n">tmap</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span>
    <span class="n">tmap</span><span class="o">.</span><span class="n">pol_conv</span> <span class="o">=</span> <span class="n">maps</span><span class="o">.</span><span class="n">MapPolConv</span><span class="o">.</span><span class="n">none</span>
    <span class="n">frame</span><span class="p">[</span><span class="s2">&quot;T&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmap</span>

    <span class="n">wgt</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;Wpol&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">TT</span>
    <span class="n">wgt</span><span class="o">.</span><span class="n">pol_conv</span> <span class="o">=</span> <span class="n">maps</span><span class="o">.</span><span class="n">MapPolConv</span><span class="o">.</span><span class="n">none</span>
    <span class="n">wgt_out</span> <span class="o">=</span> <span class="n">maps</span><span class="o">.</span><span class="n">G3SkyMapWeights</span><span class="p">()</span>
    <span class="n">wgt_out</span><span class="o">.</span><span class="n">TT</span> <span class="o">=</span> <span class="n">wgt</span>
    <span class="n">frame</span><span class="p">[</span><span class="s2">&quot;Wunpol&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wgt_out</span>

    <span class="k">del</span> <span class="n">frame</span><span class="p">[</span><span class="s2">&quot;Q&quot;</span><span class="p">]</span>
    <span class="k">del</span> <span class="n">frame</span><span class="p">[</span><span class="s2">&quot;U&quot;</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">frame</span></div>



<div class="viewcode-block" id="ValidateMaps">
<a class="viewcode-back" href="../../../moddoc_maps.html#spt3g.maps.map_modules.ValidateMaps">[docs]</a>
<span class="nd">@core</span><span class="o">.</span><span class="n">indexmod</span>
<span class="k">def</span> <span class="nf">ValidateMaps</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">ignore_missing_weights</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate that the input map frame has all the necessary keys.</span>

<span class="sd">    If ignore_missing_weights is False (default), a warning is issued when the</span>
<span class="sd">    frame contains weighted Stokes maps without a weights map.  Set this option</span>
<span class="sd">    to True when feeding single bolometer map frames with common weights through</span>
<span class="sd">    a pipeline.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">core</span><span class="o">.</span><span class="n">G3Frame</span><span class="p">)</span> <span class="ow">and</span> <span class="n">frame</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="n">core</span><span class="o">.</span><span class="n">G3FrameType</span><span class="o">.</span><span class="n">Map</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="n">map_id</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Id&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;T&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">frame</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;H&quot;</span> <span class="ow">in</span> <span class="n">frame</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">core</span><span class="o">.</span><span class="n">log_fatal</span><span class="p">(</span><span class="s2">&quot;Map frame </span><span class="si">%s</span><span class="s2">: Missing T map&quot;</span> <span class="o">%</span> <span class="n">map_id</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;ValidateMaps&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;Q&quot;</span> <span class="ow">in</span> <span class="n">frame</span> <span class="ow">and</span> <span class="ow">not</span> <span class="s2">&quot;U&quot;</span> <span class="ow">in</span> <span class="n">frame</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s2">&quot;U&quot;</span> <span class="ow">in</span> <span class="n">frame</span> <span class="ow">and</span> <span class="ow">not</span> <span class="s2">&quot;Q&quot;</span> <span class="ow">in</span> <span class="n">frame</span><span class="p">):</span>
        <span class="n">core</span><span class="o">.</span><span class="n">log_fatal</span><span class="p">(</span><span class="s2">&quot;Map frame </span><span class="si">%s</span><span class="s2">: Missing Q or U map&quot;</span> <span class="o">%</span> <span class="n">map_id</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;ValidateMaps&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;Wpol&quot;</span> <span class="ow">in</span> <span class="n">frame</span> <span class="ow">and</span> <span class="s2">&quot;Wunpol&quot;</span> <span class="ow">in</span> <span class="n">frame</span><span class="p">:</span>
        <span class="n">core</span><span class="o">.</span><span class="n">log_fatal</span><span class="p">(</span>
            <span class="s2">&quot;Map frame </span><span class="si">%s</span><span class="s2">: Found both polarized and unpolarized weights&quot;</span> <span class="o">%</span> <span class="n">map_id</span><span class="p">,</span>
            <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;ValidateMaps&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">check_weights</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">stub</span> <span class="o">=</span> <span class="n">frame</span><span class="p">[</span><span class="s2">&quot;T&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="s2">&quot;U&quot;</span><span class="p">,</span> <span class="s2">&quot;Wpol&quot;</span><span class="p">,</span> <span class="s2">&quot;Wunpol&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">frame</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">frame</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">compatible</span><span class="p">(</span><span class="n">stub</span><span class="p">):</span>
            <span class="n">core</span><span class="o">.</span><span class="n">log_fatal</span><span class="p">(</span>
                <span class="s2">&quot;Map frame </span><span class="si">%s</span><span class="s2">: Map </span><span class="si">%s</span><span class="s2"> not compatible with T map&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">map_id</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span>
                <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;ValidateMaps&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Wpol&quot;</span><span class="p">,</span> <span class="s2">&quot;Wunpol&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">frame</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">TT</span><span class="o">.</span><span class="n">pol_type</span> <span class="o">==</span> <span class="n">maps</span><span class="o">.</span><span class="n">MapPolType</span><span class="o">.</span><span class="n">TT</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="c1"># set weights polarization properties</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">wk</span> <span class="ow">in</span> <span class="n">w</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">w</span><span class="p">[</span><span class="n">wk</span><span class="p">]</span><span class="o">.</span><span class="n">pol_type</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">maps</span><span class="o">.</span><span class="n">MapPolType</span><span class="p">,</span> <span class="n">wk</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;Wpol&quot;</span><span class="p">:</span>
                    <span class="n">w</span><span class="p">[</span><span class="n">wk</span><span class="p">]</span><span class="o">.</span><span class="n">pol_conv</span> <span class="o">=</span> <span class="n">frame</span><span class="p">[</span><span class="s2">&quot;U&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pol_conv</span>
            <span class="n">frame</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">w</span>

        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="s2">&quot;TQU&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;U&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">frame</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">maps</span><span class="o">.</span><span class="n">FlatSkyMap</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
                    <span class="n">frame</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">flat_pol</span> <span class="o">!=</span> <span class="n">frame</span><span class="p">[</span><span class="s2">&quot;Q&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">flat_pol</span>
                <span class="p">):</span>
                    <span class="n">core</span><span class="o">.</span><span class="n">log_fatal</span><span class="p">(</span>
                        <span class="s2">&quot;Map frame </span><span class="si">%s</span><span class="s2">: Q and U maps have different flat_pol&quot;</span> <span class="o">%</span> <span class="n">map_id</span><span class="p">,</span>
                        <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;ValidateMaps&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="s2">&quot;QU&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">frame</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">polarized</span><span class="p">:</span>
                    <span class="n">core</span><span class="o">.</span><span class="n">log_warn</span><span class="p">(</span>
                        <span class="s2">&quot;Map frame </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2"> map polarization convention not set&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">map_id</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span>
                        <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;ValidateMaps&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
            <span class="k">if</span> <span class="n">frame</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">weighted</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">ignore_missing_weights</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;Wpol&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">frame</span> <span class="ow">and</span> <span class="s2">&quot;Wunpol&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">frame</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">check_weights</span><span class="p">:</span>
                        <span class="n">core</span><span class="o">.</span><span class="n">log_warn</span><span class="p">(</span>
                            <span class="s2">&quot;Map frame </span><span class="si">%s</span><span class="s2">: Missing weights&quot;</span> <span class="o">%</span> <span class="n">map_id</span><span class="p">,</span>
                            <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;ValidateMaps&quot;</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="n">check_weights</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;T&quot;</span> <span class="ow">and</span> <span class="s2">&quot;Q&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">frame</span> <span class="ow">and</span> <span class="s2">&quot;Wunpol&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">frame</span><span class="p">:</span>
                        <span class="n">core</span><span class="o">.</span><span class="n">log_warn</span><span class="p">(</span>
                            <span class="s2">&quot;Map frame </span><span class="si">%s</span><span class="s2">: Missing unpolarized weights&quot;</span> <span class="o">%</span> <span class="n">map_id</span><span class="p">,</span>
                            <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;ValidateMaps&quot;</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;Q&quot;</span> <span class="ow">and</span> <span class="s2">&quot;Wpol&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">frame</span><span class="p">:</span>
                        <span class="n">core</span><span class="o">.</span><span class="n">log_warn</span><span class="p">(</span>
                            <span class="s2">&quot;Map frame </span><span class="si">%s</span><span class="s2">: Missing polarized weights&quot;</span> <span class="o">%</span> <span class="n">map_id</span><span class="p">,</span>
                            <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;ValidateMaps&quot;</span><span class="p">,</span>
                        <span class="p">)</span>

        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;H&quot;</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="k">elif</span> <span class="n">frame</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">polarized</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;Q&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">frame</span> <span class="ow">or</span> <span class="s2">&quot;U&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">frame</span><span class="p">:</span>
                <span class="n">core</span><span class="o">.</span><span class="n">log_fatal</span><span class="p">(</span>
                    <span class="s2">&quot;Map frame </span><span class="si">%s</span><span class="s2">: Found unpolarized maps with polarized weights&quot;</span> <span class="o">%</span> <span class="n">map_id</span><span class="p">,</span>
                    <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;ValidateMaps&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">frame</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">pol_conv</span> <span class="o">!=</span> <span class="n">frame</span><span class="p">[</span><span class="s2">&quot;U&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pol_conv</span><span class="p">:</span>
                <span class="n">core</span><span class="o">.</span><span class="n">log_fatal</span><span class="p">(</span>
                    <span class="s2">&quot;Map frame </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2"> and U maps have different pol_conv&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">map_id</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span>
                    <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;ValidateMaps&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">frame</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">QQ</span><span class="p">,</span> <span class="n">maps</span><span class="o">.</span><span class="n">FlatSkyMap</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">frame</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">flat_pol</span> <span class="o">!=</span> <span class="n">frame</span><span class="p">[</span><span class="s2">&quot;Q&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">flat_pol</span><span class="p">:</span>
                    <span class="n">core</span><span class="o">.</span><span class="n">log_fatal</span><span class="p">(</span>
                        <span class="s2">&quot;Map frame </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2"> and U maps have different flat_pol&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">map_id</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span>
                        <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;ValidateMaps&quot;</span><span class="p">,</span>
                    <span class="p">)</span>

        <span class="k">elif</span> <span class="s2">&quot;Q&quot;</span> <span class="ow">in</span> <span class="n">frame</span> <span class="ow">or</span> <span class="s2">&quot;U&quot;</span> <span class="ow">in</span> <span class="n">frame</span><span class="p">:</span>
            <span class="n">core</span><span class="o">.</span><span class="n">log_fatal</span><span class="p">(</span>
                <span class="s2">&quot;Map frame </span><span class="si">%s</span><span class="s2">: Found polarized maps with unpolarized weights&quot;</span> <span class="o">%</span> <span class="n">map_id</span><span class="p">,</span>
                <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;ValidateMaps&quot;</span><span class="p">,</span>
            <span class="p">)</span></div>



<div class="viewcode-block" id="ExtractMaps">
<a class="viewcode-back" href="../../../moddoc_maps.html#spt3g.maps.map_modules.ExtractMaps">[docs]</a>
<span class="nd">@core</span><span class="o">.</span><span class="n">indexmod</span>
<span class="k">class</span> <span class="nc">ExtractMaps</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cache maps that come through the pipeline. Initialize an instance of this</span>
<span class="sd">    module before adding to a pipeline.  Any map frames that pass through the pipe</span>
<span class="sd">    are stored in the .maps attribute of the object after the pipeline is run.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    map_id : string</span>
<span class="sd">        If supplied, select only map frames that match this ID.</span>
<span class="sd">    copy : bool</span>
<span class="sd">        If True, make a copy of the map on extraction.</span>
<span class="sd">    ignore_missing_weights : bool</span>
<span class="sd">        If False (default), a warning is issued when the frame contains weighted</span>
<span class="sd">        Stokes maps without a weights map.  Set this option to True when feeding</span>
<span class="sd">        single bolometer map frames with common weights through a pipeline.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">map_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ignore_missing_weights</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map_id</span> <span class="o">=</span> <span class="n">map_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copy_</span> <span class="o">=</span> <span class="n">copy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ignore_missing_weights</span> <span class="o">=</span> <span class="n">ignore_missing_weights</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">maps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dictionary of map frames, keyed by Id.  Map objects are extracted from each</span>
<span class="sd">        frame in the pipeline, and stored as simple dictionaries.  Multiple frames</span>
<span class="sd">        with the same Id will result in a list of dictionaries for that Id.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_maps&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_maps</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maps</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">frame</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="n">core</span><span class="o">.</span><span class="n">G3FrameType</span><span class="o">.</span><span class="n">Map</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_id</span> <span class="ow">and</span> <span class="n">frame</span><span class="p">[</span><span class="s2">&quot;Id&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_id</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">ValidateMaps</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">ignore_missing_weights</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ignore_missing_weights</span><span class="p">)</span>

        <span class="n">mid</span> <span class="o">=</span> <span class="n">frame</span><span class="p">[</span><span class="s2">&quot;Id&quot;</span><span class="p">]</span>
        <span class="n">mdict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="s2">&quot;U&quot;</span><span class="p">,</span> <span class="s2">&quot;Wpol&quot;</span><span class="p">,</span> <span class="s2">&quot;Wunpol&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">frame</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">mdict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">frame</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy_</span> <span class="k">else</span> <span class="n">frame</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">mid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">maps</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">maps</span><span class="p">[</span><span class="n">mid</span><span class="p">]</span> <span class="o">=</span> <span class="n">mdict</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maps</span><span class="p">[</span><span class="n">mid</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">maps</span><span class="p">[</span><span class="n">mid</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">maps</span><span class="p">[</span><span class="n">mid</span><span class="p">],</span> <span class="n">mdict</span><span class="p">]</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">maps</span><span class="p">[</span><span class="n">mid</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mdict</span><span class="p">)</span></div>



<div class="viewcode-block" id="InjectMapStub">
<a class="viewcode-back" href="../../../moddoc_maps.html#spt3g.maps.map_modules.InjectMapStub">[docs]</a>
<span class="nd">@core</span><span class="o">.</span><span class="n">indexmod</span>
<span class="k">class</span> <span class="nc">InjectMapStub</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inject a new map frame from a map stub.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    map_id : string</span>
<span class="sd">        Id to assign to the new map frame</span>
<span class="sd">    map_stub : G3SkyMap instance</span>
<span class="sd">        Map stub from which to clone the Stokes maps and weights.  If the</span>
<span class="sd">        `weighted` attribute of the stub is True, the output frame will include</span>
<span class="sd">        weights.  If the `pol_conv` attribute of the stub is not None, the</span>
<span class="sd">        output frame will include Q and U maps (and polarized weights).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">map_id</span><span class="p">,</span> <span class="n">map_stub</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map_frame</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">G3Frame</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">G3FrameType</span><span class="o">.</span><span class="n">Map</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map_frame</span><span class="p">[</span><span class="s2">&quot;Id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">map_id</span>

        <span class="n">map_stub</span> <span class="o">=</span> <span class="n">map_stub</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">weighted</span> <span class="o">=</span> <span class="n">map_stub</span><span class="o">.</span><span class="n">weighted</span>
        <span class="n">polarized</span> <span class="o">=</span> <span class="n">map_stub</span><span class="o">.</span><span class="n">polarized</span>

        <span class="n">T</span> <span class="o">=</span> <span class="n">map_stub</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">T</span><span class="o">.</span><span class="n">pol_type</span> <span class="o">=</span> <span class="n">maps</span><span class="o">.</span><span class="n">MapPolType</span><span class="o">.</span><span class="n">T</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map_frame</span><span class="p">[</span><span class="s2">&quot;T&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">T</span>
        <span class="k">if</span> <span class="n">polarized</span><span class="p">:</span>
            <span class="n">Q</span> <span class="o">=</span> <span class="n">map_stub</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">Q</span><span class="o">.</span><span class="n">pol_type</span> <span class="o">=</span> <span class="n">maps</span><span class="o">.</span><span class="n">MapPolType</span><span class="o">.</span><span class="n">Q</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">map_frame</span><span class="p">[</span><span class="s2">&quot;Q&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span>
            <span class="n">U</span> <span class="o">=</span> <span class="n">map_stub</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">U</span><span class="o">.</span><span class="n">pol_type</span> <span class="o">=</span> <span class="n">maps</span><span class="o">.</span><span class="n">MapPolType</span><span class="o">.</span><span class="n">U</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">map_frame</span><span class="p">[</span><span class="s2">&quot;U&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">U</span>
        <span class="k">if</span> <span class="n">weighted</span><span class="p">:</span>
            <span class="n">W</span> <span class="o">=</span> <span class="n">maps</span><span class="o">.</span><span class="n">G3SkyMapWeights</span><span class="p">(</span><span class="n">map_stub</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">map_frame</span><span class="p">[</span><span class="s2">&quot;Wpol&quot;</span> <span class="k">if</span> <span class="n">polarized</span> <span class="k">else</span> <span class="s2">&quot;Wunpol&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">W</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_frame</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">map_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_frame</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map_frame</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">map_frame</span><span class="p">,</span> <span class="n">frame</span><span class="p">]</span></div>



<div class="viewcode-block" id="InjectMaps">
<a class="viewcode-back" href="../../../moddoc_maps.html#spt3g.maps.map_modules.InjectMaps">[docs]</a>
<span class="nd">@core</span><span class="o">.</span><span class="n">indexmod</span>
<span class="k">class</span> <span class="nc">InjectMaps</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inject a set of maps into a new map frame.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    map_id : string</span>
<span class="sd">        Id to assign to the new map frame</span>
<span class="sd">    maps_in : list or dict</span>
<span class="sd">        Maps to add to the frame.  If a list, contains Stokes maps with valid</span>
<span class="sd">        pol_type and weights.  If a dict, contains Stokes and weights maps keyed</span>
<span class="sd">        by the standard map frame names.</span>
<span class="sd">    ignore_missing_weights : bool</span>
<span class="sd">        Skip warning about missing weights.  Useful for masks.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">map_id</span><span class="p">,</span> <span class="n">maps_in</span><span class="p">,</span> <span class="n">ignore_missing_weights</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map_frame</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">G3Frame</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">G3FrameType</span><span class="o">.</span><span class="n">Map</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map_frame</span><span class="p">[</span><span class="s2">&quot;Id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">map_id</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">maps_in</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">maps_in</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">maps</span><span class="o">.</span><span class="n">G3SkyMap</span><span class="p">):</span>
                    <span class="n">k</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">pol_type</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="s2">&quot;TQU&quot;</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Input map has invalid pol_type </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">k</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">map_frame</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">maps</span><span class="o">.</span><span class="n">G3SkyMapWeights</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">map_frame</span><span class="p">[</span><span class="s2">&quot;Wpol&quot;</span> <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">polarized</span> <span class="k">else</span> <span class="s2">&quot;Wunpol&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;maps_in must be G3SkyMap or G3SkyMapWeights&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">maps_in</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">maps_in</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="s2">&quot;U&quot;</span><span class="p">,</span> <span class="s2">&quot;Wpol&quot;</span><span class="p">,</span> <span class="s2">&quot;Wunpol&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">]:</span>
                    <span class="k">continue</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">map_frame</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;maps_in must be a list or dict&quot;</span><span class="p">)</span>

        <span class="n">ValidateMaps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map_frame</span><span class="p">,</span> <span class="n">ignore_missing_weights</span><span class="o">=</span><span class="n">ignore_missing_weights</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_frame</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">map_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_frame</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map_frame</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">map_frame</span><span class="p">,</span> <span class="n">frame</span><span class="p">]</span></div>



<div class="viewcode-block" id="ReplicateMaps">
<a class="viewcode-back" href="../../../moddoc_maps.html#spt3g.maps.map_modules.ReplicateMaps">[docs]</a>
<span class="nd">@core</span><span class="o">.</span><span class="n">indexmod</span>
<span class="k">def</span> <span class="nf">ReplicateMaps</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">input_map_id</span><span class="p">,</span> <span class="n">output_map_ids</span><span class="p">,</span> <span class="n">copy_weights</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Clone the input map frame with Id input_map_id into new stub frames, one for</span>
<span class="sd">    each Id listed in output_map_ids.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    input_map_id : string</span>
<span class="sd">        ID of the map frame to replicate.  The input frame is discarded after</span>
<span class="sd">        replication.</span>
<span class="sd">    output_map_ids : list of strings</span>
<span class="sd">        List of IDs to assign to replicated map frames.</span>
<span class="sd">    copy_weights : bool</span>
<span class="sd">        If False, only the first output frame in the list includes a weights key</span>
<span class="sd">        (Wpol or Wunpol).  If True, all output frames include a weights key.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">frame</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="n">core</span><span class="o">.</span><span class="n">G3FrameType</span><span class="o">.</span><span class="n">Map</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="n">frame</span><span class="p">[</span><span class="s2">&quot;Id&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">input_map_id</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="n">ValidateMaps</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

    <span class="n">frames</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">first</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">for</span> <span class="n">oid</span> <span class="ow">in</span> <span class="n">output_map_ids</span><span class="p">:</span>
        <span class="n">fr</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">G3Frame</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">G3FrameType</span><span class="o">.</span><span class="n">Map</span><span class="p">)</span>
        <span class="n">fr</span><span class="p">[</span><span class="s2">&quot;Id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">oid</span>
        <span class="k">if</span> <span class="n">copy_weights</span> <span class="ow">or</span> <span class="n">first</span><span class="p">:</span>
            <span class="n">map_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="s2">&quot;U&quot;</span><span class="p">,</span> <span class="s2">&quot;Wpol&quot;</span><span class="p">,</span> <span class="s2">&quot;Wunpol&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">]</span>
            <span class="n">first</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">map_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="s2">&quot;U&quot;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">map_keys</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">frame</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">fr</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">frame</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fr</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">frames</span></div>



<div class="viewcode-block" id="InvertMaps">
<a class="viewcode-back" href="../../../moddoc_maps.html#spt3g.maps.map_modules.InvertMaps">[docs]</a>
<span class="nd">@core</span><span class="o">.</span><span class="n">indexmod</span>
<span class="k">def</span> <span class="nf">InvertMaps</span><span class="p">(</span><span class="n">frame</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Invert T, Q, U maps in the input map frame.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">frame</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="n">core</span><span class="o">.</span><span class="n">G3FrameType</span><span class="o">.</span><span class="n">Map</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="s2">&quot;TQU&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">frame</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="n">m</span> <span class="o">*=</span> <span class="o">-</span><span class="mf">1.0</span>
            <span class="n">frame</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span>

    <span class="k">return</span> <span class="n">frame</span></div>



<div class="viewcode-block" id="InvertAlternatingMaps">
<a class="viewcode-back" href="../../../moddoc_maps.html#spt3g.maps.map_modules.InvertAlternatingMaps">[docs]</a>
<span class="nd">@core</span><span class="o">.</span><span class="n">indexmod</span>
<span class="k">class</span> <span class="nc">InvertAlternatingMaps</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Invert T, Q, U maps in every other input map frame.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flip</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">frame</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="n">core</span><span class="o">.</span><span class="n">G3FrameType</span><span class="o">.</span><span class="n">Map</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flip</span><span class="p">:</span>
            <span class="n">InvertMaps</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flip</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">flip</span>

        <span class="k">return</span> <span class="n">frame</span></div>



<div class="viewcode-block" id="RescaleMaps">
<a class="viewcode-back" href="../../../moddoc_maps.html#spt3g.maps.map_modules.RescaleMaps">[docs]</a>
<span class="nd">@core</span><span class="o">.</span><span class="n">indexmod</span>
<span class="k">def</span> <span class="nf">RescaleMaps</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">t_scale</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">q_scale</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">u_scale</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Rescale input map frame using the supplied calibration factors for each</span>
<span class="sd">    Stokes component.  If the maps are weighted, the T, Q, and U components are</span>
<span class="sd">    divide the appropriate scale factor.  If the maps are unweighted, the Stokes</span>
<span class="sd">    components are multiplied by the appropriate scale factor.  If weight maps</span>
<span class="sd">    are present in the frame, each weight component is divided by the product of</span>
<span class="sd">    the scale factors that make up each weight component.  In this way, calling</span>
<span class="sd">    ``RemoveWeights`` on the map frame resulting from this module should produce</span>
<span class="sd">    an unweighted map that has been multiplied by the input scale factors.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    t_scale : float</span>
<span class="sd">    q_scale : float</span>
<span class="sd">    u_scale : float</span>
<span class="sd">        Scale factor to apply to each Stokes component in the maps and weights.</span>
<span class="sd">        If not supplied, assumed to be unity.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">frame</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="n">core</span><span class="o">.</span><span class="n">G3FrameType</span><span class="o">.</span><span class="n">Map</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="n">ValidateMaps</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

    <span class="n">t_scale</span> <span class="o">=</span> <span class="n">t_scale</span> <span class="k">if</span> <span class="n">t_scale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mf">1.0</span>
    <span class="n">q_scale</span> <span class="o">=</span> <span class="n">q_scale</span> <span class="k">if</span> <span class="n">q_scale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mf">1.0</span>
    <span class="n">u_scale</span> <span class="o">=</span> <span class="n">u_scale</span> <span class="k">if</span> <span class="n">u_scale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mf">1.0</span>

    <span class="n">weighted</span> <span class="o">=</span> <span class="n">frame</span><span class="p">[</span><span class="s2">&quot;T&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">weighted</span>

    <span class="n">scales</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;T&quot;</span><span class="p">:</span> <span class="n">t_scale</span> <span class="k">if</span> <span class="n">weighted</span> <span class="k">else</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">t_scale</span><span class="p">,</span>
        <span class="s2">&quot;Q&quot;</span><span class="p">:</span> <span class="n">q_scale</span> <span class="k">if</span> <span class="n">weighted</span> <span class="k">else</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">q_scale</span><span class="p">,</span>
        <span class="s2">&quot;U&quot;</span><span class="p">:</span> <span class="n">u_scale</span> <span class="k">if</span> <span class="n">weighted</span> <span class="k">else</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">u_scale</span><span class="p">,</span>
        <span class="s2">&quot;TT&quot;</span><span class="p">:</span> <span class="n">t_scale</span> <span class="o">*</span> <span class="n">t_scale</span><span class="p">,</span>
        <span class="s2">&quot;TQ&quot;</span><span class="p">:</span> <span class="n">t_scale</span> <span class="o">*</span> <span class="n">q_scale</span><span class="p">,</span>
        <span class="s2">&quot;TU&quot;</span><span class="p">:</span> <span class="n">t_scale</span> <span class="o">*</span> <span class="n">u_scale</span><span class="p">,</span>
        <span class="s2">&quot;QQ&quot;</span><span class="p">:</span> <span class="n">q_scale</span> <span class="o">*</span> <span class="n">q_scale</span><span class="p">,</span>
        <span class="s2">&quot;QU&quot;</span><span class="p">:</span> <span class="n">q_scale</span> <span class="o">*</span> <span class="n">u_scale</span><span class="p">,</span>
        <span class="s2">&quot;UU&quot;</span><span class="p">:</span> <span class="n">u_scale</span> <span class="o">*</span> <span class="n">u_scale</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">wkey</span> <span class="o">=</span> <span class="s2">&quot;Wpol&quot;</span> <span class="k">if</span> <span class="s2">&quot;Wpol&quot;</span> <span class="ow">in</span> <span class="n">frame</span> <span class="k">else</span> <span class="s2">&quot;Wunpol&quot;</span> <span class="k">if</span> <span class="s2">&quot;Wunpol&quot;</span> <span class="ow">in</span> <span class="n">frame</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">wkey</span><span class="p">)</span> <span class="k">if</span> <span class="n">wkey</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">scale</span> <span class="ow">in</span> <span class="n">scales</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">scale</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">frame</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="n">m</span> <span class="o">/=</span> <span class="n">scale</span>
            <span class="n">frame</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span>
        <span class="k">elif</span> <span class="n">weights</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">weights</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">weights</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/=</span> <span class="n">scale</span>

    <span class="k">if</span> <span class="n">wkey</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">frame</span><span class="p">[</span><span class="n">wkey</span><span class="p">]</span> <span class="o">=</span> <span class="n">weights</span>

    <span class="k">return</span> <span class="n">frame</span></div>



<div class="viewcode-block" id="CoaddMaps">
<a class="viewcode-back" href="../../../moddoc_maps.html#spt3g.maps.map_modules.CoaddMaps">[docs]</a>
<span class="nd">@core</span><span class="o">.</span><span class="n">indexmod</span>
<span class="k">class</span> <span class="nc">CoaddMaps</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Coadd maps and weights, optionally collating by map Id.  This class can be</span>
<span class="sd">    used as an argument to ``pipe.Add()`` as a standard pipeline module, or</span>
<span class="sd">    instantiated as a standalone instance.  In the latter case, the object is</span>
<span class="sd">    treated as a callable for input map frames, and the ``coadd_frame`` or</span>
<span class="sd">    ``coadd_frames`` attribute contains the running coadd(s).</span>

<span class="sd">    The output coadd frames contain two additional keys: ``&#39;InputMapIds&#39;`` and</span>
<span class="sd">    ``&#39;InputFiles&#39;``, which are both lists of unique map Id&#39;s and filenames that</span>
<span class="sd">    are associated with the frames that contribute to each coadd.  When one</span>
<span class="sd">    coadd is added to another, these keys are updated recursively, so that the</span>
<span class="sd">    resulting coadd includes the Id&#39;s and filenames that contributed to both</span>
<span class="sd">    itself and the other coadd.  The list of filenames can be populated by</span>
<span class="sd">    combining this module with a G3Reader whose ``track_filename`` option is set</span>
<span class="sd">    to True; however, this feature is fragile and may not work as expected with</span>
<span class="sd">    complex pipelines.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">map_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">output_map_id</span><span class="o">=</span><span class="s2">&quot;Coadd&quot;</span><span class="p">,</span>
        <span class="n">collate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">weighted</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">ignore_missing_weights</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">drop_input_frames</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">record_obs_id</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">keep_outputs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        map_ids : list of str</span>
<span class="sd">            List of map Id&#39;s to include in the coadd(s).  If None, any maps in the</span>
<span class="sd">            pipeline are included.  Otherwise, the output of the ``get_map_ids``</span>
<span class="sd">            method is compared with this list, and the input frame is discarded if</span>
<span class="sd">            no match is found.</span>
<span class="sd">        output_map_id : str</span>
<span class="sd">            Id to assign to the output frame.  If ``collate`` is True, this argument</span>
<span class="sd">            is required and treated as a prefix to which each input map Id is</span>
<span class="sd">            appended.</span>
<span class="sd">        collate : bool</span>
<span class="sd">            If True, coadd unique map Id&#39;s into separate output map frames.</span>
<span class="sd">        weighted : bool</span>
<span class="sd">            If True (default), ensure that maps have had weights applied before</span>
<span class="sd">            coadding.  Otherwise, coadd maps without checking the weights.</span>
<span class="sd">        ignore_missing_weights : bool</span>
<span class="sd">            If False (default), a warning is issued when the frame contains weighted</span>
<span class="sd">            Stokes maps without a weights map.  Set this option to True when feeding</span>
<span class="sd">            single bolometer map frames with common weights through a pipeline.</span>
<span class="sd">        drop_input_frames : bool</span>
<span class="sd">            If True, drop input map frames from the pipeline that are included in</span>
<span class="sd">            any coadds.</span>
<span class="sd">        record_obs_id : bool</span>
<span class="sd">            If True, include source name and observation ID info in the output coadd</span>
<span class="sd">            frame ``InputMapIds`` key, along with the map ID for each input frame.</span>
<span class="sd">            If False, only the map frame ID is included.</span>
<span class="sd">        keep_outputs : bool</span>
<span class="sd">            If True, preserve the coadd frame module attributes after parsing an</span>
<span class="sd">            EndProcessing frame.  Otherwise, coadd frames are deleted to avoid</span>
<span class="sd">            memory leaks in pipelines, under the assumption that ownership of the</span>
<span class="sd">            frame(s) is transfered to downstream modules, e.g. G3Writer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">map_ids</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">map_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">map_ids</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map_ids</span> <span class="o">=</span> <span class="n">map_ids</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collate</span> <span class="o">=</span> <span class="n">collate</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">collate</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_map_id</span> <span class="o">=</span> <span class="n">output_map_id</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coadd_frame</span><span class="p">[</span><span class="s2">&quot;Id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output_map_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weighted</span> <span class="o">=</span> <span class="n">weighted</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ignore_missing_weights</span> <span class="o">=</span> <span class="n">ignore_missing_weights</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drop_input_frames</span> <span class="o">=</span> <span class="n">drop_input_frames</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">obs_id</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">record_obs_id</span> <span class="k">else</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keep_outputs</span> <span class="o">=</span> <span class="n">keep_outputs</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">coadd_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Output coadd map frame, also injected into the pipeline on</span>
<span class="sd">        EndProcessing.  This attribute is only populated if the ``collate``</span>
<span class="sd">        option is set to False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">collate</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Collation is enabled, use .coadd_frames instead.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_coadd_frame&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_coadd_frame</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">G3Frame</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">G3FrameType</span><span class="o">.</span><span class="n">Map</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coadd_frame</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">coadd_frames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dictionary of output coadd map frames, keyed by input map Id.  Each</span>
<span class="sd">        frame is also injected into the pipeline on EndProcessing.  This</span>
<span class="sd">        attribute is only populated if the ``collate`` option is set to True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">collate</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Collation is disabled, use .coadd_frame instead.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_coadd_frames&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_coadd_frames</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coadd_frames</span>

<div class="viewcode-block" id="CoaddMaps.reset">
<a class="viewcode-back" href="../../../moddoc_maps.html#spt3g.maps.map_modules.CoaddMaps.reset">[docs]</a>
    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clear internal frame cache.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">collate</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coadd_frames</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">delattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_coadd_frame&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="CoaddMaps.get_map_id">
<a class="viewcode-back" href="../../../moddoc_maps.html#spt3g.maps.map_modules.CoaddMaps.get_map_id">[docs]</a>
    <span class="k">def</span> <span class="nf">get_map_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return Id associated with the input frame</span>

<span class="sd">        By default, this returns the &quot;Id&quot; entry in the frame, None if not found.</span>
<span class="sd">        Subclass the CoaddMaps structure to override the default behavior.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        frame : core.G3Frame instance of type G3FrameType.Map</span>
<span class="sd">            Candidate map frame to include in a coadd.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        map_id : str, None or False</span>
<span class="sd">            A string if the frame is to be included in a coadd, None if the</span>
<span class="sd">            frame is to be passed on to downstream pipeline modules, or False if</span>
<span class="sd">            the frame is to be dropped from the pipeline altogether.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">frame</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Id&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">core</span><span class="o">.</span><span class="n">G3Frame</span><span class="p">)</span> <span class="ow">and</span> <span class="n">frame</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">core</span><span class="o">.</span><span class="n">G3FrameType</span><span class="o">.</span><span class="n">EndProcessing</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">collate</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coadd_frames</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">+</span> <span class="p">[</span><span class="n">frame</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">coadd_frame</span><span class="p">,</span> <span class="n">frame</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">keep_outputs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">out</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">obs_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span> <span class="ow">and</span> <span class="s2">&quot;SourceName&quot;</span> <span class="ow">in</span> <span class="n">frame</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">obs_id</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">frame</span><span class="p">[</span><span class="s2">&quot;SourceName&quot;</span><span class="p">],</span> <span class="n">frame</span><span class="p">[</span><span class="s2">&quot;ObservationID&quot;</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">core</span><span class="o">.</span><span class="n">G3Frame</span><span class="p">)</span> <span class="ow">and</span> <span class="n">frame</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="n">core</span><span class="o">.</span><span class="n">G3FrameType</span><span class="o">.</span><span class="n">Map</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">map_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_map_id</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">map_id</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">map_id</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">map_id</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">map_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_ids</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">ValidateMaps</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">ignore_missing_weights</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ignore_missing_weights</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">weighted</span><span class="p">:</span>
            <span class="n">ApplyWeights</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">collate</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">map_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coadd_frames</span><span class="p">:</span>
                <span class="n">fr</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">G3Frame</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">G3FrameType</span><span class="o">.</span><span class="n">Map</span><span class="p">)</span>
                <span class="n">fr</span><span class="p">[</span><span class="s2">&quot;Id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_map_id</span> <span class="o">+</span> <span class="n">map_id</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">coadd_frames</span><span class="p">[</span><span class="n">map_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">fr</span>
            <span class="n">cfr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coadd_frames</span><span class="p">[</span><span class="n">map_id</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cfr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coadd_frame</span>

        <span class="k">if</span> <span class="s2">&quot;InputMapIds&quot;</span> <span class="ow">in</span> <span class="n">cfr</span><span class="p">:</span>
            <span class="n">map_ids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cfr</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;InputMapIds&quot;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">map_ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="s2">&quot;InputMapIds&quot;</span> <span class="ow">in</span> <span class="n">frame</span><span class="p">:</span>
            <span class="c1"># allow for recursive coadds</span>
            <span class="n">map_ids</span> <span class="o">+=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">frame</span><span class="p">[</span><span class="s2">&quot;InputMapIds&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">map_ids</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">frame</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Id&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">mid</span> <span class="o">=</span> <span class="n">frame</span><span class="p">[</span><span class="s2">&quot;Id&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">obs_id</span><span class="p">:</span>
                <span class="n">mid</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obs_id</span><span class="p">,</span> <span class="n">mid</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">map_ids</span><span class="p">:</span>
                <span class="n">map_ids</span> <span class="o">+=</span> <span class="p">[</span><span class="n">mid</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">map_ids</span><span class="p">):</span>
            <span class="n">cfr</span><span class="p">[</span><span class="s2">&quot;InputMapIds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">G3VectorString</span><span class="p">(</span><span class="n">map_ids</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;InputFiles&quot;</span> <span class="ow">in</span> <span class="n">cfr</span><span class="p">:</span>
            <span class="n">input_files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cfr</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;InputFiles&quot;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">input_files</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="s2">&quot;InputFiles&quot;</span> <span class="ow">in</span> <span class="n">frame</span><span class="p">:</span>
            <span class="c1"># allow for recursive coadds</span>
            <span class="n">input_files</span> <span class="o">+=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">frame</span><span class="p">[</span><span class="s2">&quot;InputFiles&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">f</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">input_files</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="s2">&quot;_filename&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">frame</span><span class="o">.</span><span class="n">_filename</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">input_files</span><span class="p">:</span>
                <span class="n">input_files</span> <span class="o">+=</span> <span class="p">[</span><span class="n">frame</span><span class="o">.</span><span class="n">_filename</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_files</span><span class="p">):</span>
            <span class="n">cfr</span><span class="p">[</span><span class="s2">&quot;InputFiles&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">G3VectorString</span><span class="p">(</span><span class="n">input_files</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="s2">&quot;U&quot;</span><span class="p">,</span> <span class="s2">&quot;Wpol&quot;</span><span class="p">,</span> <span class="s2">&quot;Wunpol&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">frame</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cfr</span><span class="p">:</span>
                <span class="n">cfr</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">frame</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">cfr</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="n">m</span> <span class="o">+=</span> <span class="n">frame</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="n">cfr</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">drop_input_frames</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>



<div class="viewcode-block" id="coadd_map_files">
<a class="viewcode-back" href="../../../moddoc_maps.html#spt3g.maps.map_modules.coadd_map_files">[docs]</a>
<span class="nd">@core</span><span class="o">.</span><span class="n">usefulfunc</span>
<span class="k">def</span> <span class="nf">coadd_map_files</span><span class="p">(</span>
    <span class="n">input_files</span><span class="p">,</span>
    <span class="n">output_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">coadder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">map_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">output_map_id</span><span class="o">=</span><span class="s2">&quot;Coadd&quot;</span><span class="p">,</span>
    <span class="n">collate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">weighted</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">record_obs_id</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Coadd map files, optionally collating map Id&#39;s into separate frames.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    input_files : list of str</span>
<span class="sd">        List of input files to feed through the pipeline.</span>
<span class="sd">    output_file : str</span>
<span class="sd">        Output G3 filename.  If not supplied, the output frames are</span>
<span class="sd">        returned without saving to disk.</span>
<span class="sd">    coadder : CoaddMaps instance</span>
<span class="sd">        If set, use this instantiated module in the coadding pipeline.</span>
<span class="sd">        In this case, all other keyword arguments below are ignored.</span>
<span class="sd">    map_ids : list of str</span>
<span class="sd">        A list of map Id&#39;s to include in the coadd(s).</span>
<span class="sd">    output_map_id : str</span>
<span class="sd">        Id to use for the output map frame.  If ``collate`` is True,</span>
<span class="sd">        this is the prefix applied to each output frame, with the</span>
<span class="sd">        input map Id appended to it.</span>
<span class="sd">    collate : bool</span>
<span class="sd">        If True, coadd individual map Id&#39;s into separate map frames.</span>
<span class="sd">        Otherwise, all map frames are coadded into one output frame.</span>
<span class="sd">    weighted : bool</span>
<span class="sd">        If True, ensure that weights have been applied before coadding.</span>
<span class="sd">        Otherwise, the input maps are coadded as they are.</span>
<span class="sd">    record_obs_id : bool</span>
<span class="sd">        If True, include source name and observation ID info in the output coadd</span>
<span class="sd">        frame ``InputMapIds`` key, along with the map ID for each input frame.</span>
<span class="sd">        If False, only the map frame ID is included.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    maps : G3Frame or dict of G3Frames</span>
<span class="sd">        If ``collate`` is True, returns a dictionary of map frames</span>
<span class="sd">        keyed by Id.  Otherwise, returns a single map frame.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">pipe</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">G3Pipeline</span><span class="p">()</span>
    <span class="n">pipe</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">G3Reader</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">input_files</span><span class="p">,</span> <span class="n">track_filename</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># build coadds</span>
    <span class="k">if</span> <span class="n">coadder</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">coadder</span> <span class="o">=</span> <span class="n">CoaddMaps</span><span class="p">(</span>
            <span class="n">map_ids</span><span class="o">=</span><span class="n">map_ids</span><span class="p">,</span>
            <span class="n">output_map_id</span><span class="o">=</span><span class="n">output_map_id</span><span class="p">,</span>
            <span class="n">collate</span><span class="o">=</span><span class="n">collate</span><span class="p">,</span>
            <span class="n">weighted</span><span class="o">=</span><span class="n">weighted</span><span class="p">,</span>
            <span class="n">drop_input_frames</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">record_obs_id</span><span class="o">=</span><span class="n">record_obs_id</span><span class="p">,</span>
            <span class="n">keep_outputs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">pipe</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">coadder</span><span class="p">)</span>

    <span class="c1"># drop metadata frames</span>
    <span class="n">pipe</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="k">lambda</span> <span class="n">fr</span><span class="p">:</span> <span class="n">fr</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">core</span><span class="o">.</span><span class="n">G3FrameType</span><span class="o">.</span><span class="n">Map</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">output_file</span><span class="p">:</span>
        <span class="n">pipe</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">G3Writer</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">output_file</span><span class="p">)</span>
    <span class="n">pipe</span><span class="o">.</span><span class="n">Run</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">collate</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">coadder</span><span class="o">.</span><span class="n">coadd_frames</span>
    <span class="k">return</span> <span class="n">coadder</span><span class="o">.</span><span class="n">coadd_frame</span></div>



<div class="viewcode-block" id="RebinMaps">
<a class="viewcode-back" href="../../../moddoc_maps.html#spt3g.maps.map_modules.RebinMaps">[docs]</a>
<span class="nd">@core</span><span class="o">.</span><span class="n">indexmod</span>
<span class="k">def</span> <span class="nf">RebinMaps</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">weighted</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Rebin any maps in the input frame into larger pixels by summing scale-x-scale</span>
<span class="sd">    blocks of pixels together.  Map dimensions must be a multiple of the rebinning</span>
<span class="sd">    scale.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    scale : int</span>
<span class="sd">        Rebinning scale factor, such that scale-x-scale blocks of pixels are summed</span>
<span class="sd">        into larger pixels.  Must divide evenly into all map pixel dimensions.</span>
<span class="sd">    weighted : bool</span>
<span class="sd">        If True (default), ensure that maps have had weights applied before</span>
<span class="sd">        rebinning.  Otherwise, rebin maps without checking the weights.</span>
<span class="sd">    norm : bool</span>
<span class="sd">        If False (default), sum all of the sub-pixels into each larger output pixel.</span>
<span class="sd">        If True, normalize the output pixel by the number of sub-pixels each</span>
<span class="sd">        encloses.  Only applies to Stokes parameters T/Q/U, not weights or hits.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">scale</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="n">weighted</span><span class="p">:</span>
        <span class="n">ApplyWeights</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="s2">&quot;U&quot;</span><span class="p">,</span> <span class="s2">&quot;Wunpol&quot;</span><span class="p">,</span> <span class="s2">&quot;Wpol&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">frame</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="s2">&quot;TQU&quot;</span><span class="p">:</span>
                <span class="n">frame</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">rebin</span><span class="p">(</span><span class="n">scale</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;H&quot;</span><span class="p">:</span>
                <span class="n">frame</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">rebin</span><span class="p">(</span><span class="n">scale</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">weighted</span> <span class="ow">and</span> <span class="n">norm</span><span class="p">:</span>
                    <span class="n">core</span><span class="o">.</span><span class="n">log_warn</span><span class="p">(</span>
                        <span class="s2">&quot;Rebinning weighted frames with norm=True may result &quot;</span>
                        <span class="s2">&quot;in inconsistent maps and weights&quot;</span><span class="p">,</span>
                        <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;RebinMaps&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="n">frame</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">rebin</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span></div>



<div class="viewcode-block" id="ReprojectMaps">
<a class="viewcode-back" href="../../../moddoc_maps.html#spt3g.maps.map_modules.ReprojectMaps">[docs]</a>
<span class="nd">@core</span><span class="o">.</span><span class="n">indexmod</span>
<span class="k">class</span> <span class="nc">ReprojectMaps</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reproject a map frame into a different projection.  Original data are</span>
<span class="sd">    dropped and replaced by reprojected maps in the input frames.  Maps can be</span>
<span class="sd">    changed between flat sky and healpix pixelizations, rotated between</span>
<span class="sd">    Equatorial and Galactic coordinates, and/or change polarization convention</span>
<span class="sd">    between COSMO and IAU, by setting the appropriate attributes of the input</span>
<span class="sd">    and stub maps.  Attributes not defined in the stub map are assumed to be</span>
<span class="sd">    that of the input map.  NB: coordinate rotation of polarized maps is not</span>
<span class="sd">    currently implemented.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    map_stub : G3SkyMap object</span>
<span class="sd">        A stub (empty) sky map object to be used to construct the output maps.</span>
<span class="sd">        Can be a HealpixSkyMap or FlatSkyMap object.  Setting the ``pol_conv``</span>
<span class="sd">        and/or ``coord_ref`` attributes to values that differ from those of the</span>
<span class="sd">        input maps will result in output maps whose polarization convention</span>
<span class="sd">        and/or reference coordinate system have been changed.</span>
<span class="sd">    rebin : int</span>
<span class="sd">        If supplied and &gt;1, subdivide the output pixel by n x n with each</span>
<span class="sd">        sub-pixel taking on the input map values at pixel center (with interp or</span>
<span class="sd">        nearest neighbor). The output pixel takes on the average of the</span>
<span class="sd">        sub-pixel values.  In the case that the input map has higher resolution</span>
<span class="sd">        than the output map (and that the input map is not low-pass filtered to</span>
<span class="sd">        remove information above the Nyquist freq. of the output map pixel),</span>
<span class="sd">        this reduces aliasing compared with direct sampling. But there would</span>
<span class="sd">        still be aliased power from the input map from freq above the ouput map</span>
<span class="sd">        pixel&#39;s Nyquist.</span>
<span class="sd">    interp : bool</span>
<span class="sd">        If True, use bilinear interpolation to extract values from the input</span>
<span class="sd">        map.  Otherwise, the nearest-neighbor value is used.</span>
<span class="sd">    weighted : bool</span>
<span class="sd">        If True (default), ensure that maps have had weights applied before</span>
<span class="sd">        reprojection.  Otherwise, reproject maps without checking the weights.</span>
<span class="sd">    partial :  bool</span>
<span class="sd">        If True, the reproj will be performed on a partial map (of the output map),</span>
<span class="sd">        defined by the mask. If the mask is not provided, it will be determined from</span>
<span class="sd">        the non-zero pixels of the first reprojected map.</span>
<span class="sd">    mask : G3SkyMapMask, G3SkyMap, or np.ndarray, optional</span>
<span class="sd">        Mask to be used for partial reproject. This should be of the same size as the</span>
<span class="sd">        output map. For numpy array, all zeros/inf/nan/hp.UNSEEN pixels are skipped.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">map_stub</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">rebin</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">interp</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">weighted</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">partial</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">assert</span> <span class="n">map_stub</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;map_stub argument required&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stub</span> <span class="o">=</span> <span class="n">map_stub</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">pol_type</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rebin</span> <span class="o">=</span> <span class="n">rebin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interp</span> <span class="o">=</span> <span class="n">interp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weighted</span> <span class="o">=</span> <span class="n">weighted</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mask</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">partial</span> <span class="o">=</span> <span class="n">partial</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">core</span><span class="o">.</span><span class="n">G3Frame</span><span class="p">)</span> <span class="ow">and</span> <span class="n">frame</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="n">core</span><span class="o">.</span><span class="n">G3FrameType</span><span class="o">.</span><span class="n">Map</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="s2">&quot;Q&quot;</span> <span class="ow">in</span> <span class="n">frame</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">coord_ref</span> <span class="o">!=</span> <span class="n">frame</span><span class="p">[</span><span class="s2">&quot;Q&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">coord_ref</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Coordinate rotation of polarized maps is not implemented&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">weighted</span><span class="p">:</span>
            <span class="n">ApplyWeights</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;U&quot;</span> <span class="ow">in</span> <span class="n">frame</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">polarized</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">pol_conv</span> <span class="o">=</span> <span class="n">frame</span><span class="p">[</span><span class="s2">&quot;U&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pol_conv</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="s2">&quot;U&quot;</span><span class="p">,</span> <span class="s2">&quot;Wpol&quot;</span><span class="p">,</span> <span class="s2">&quot;Wunpol&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">]:</span>

            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">frame</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">m</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="s2">&quot;TQUH&quot;</span><span class="p">:</span>
                <span class="n">mnew</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">maps</span><span class="o">.</span><span class="n">reproj_map</span><span class="p">(</span>
                    <span class="n">m</span><span class="p">,</span> <span class="n">mnew</span><span class="p">,</span> <span class="n">rebin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rebin</span><span class="p">,</span> <span class="n">interp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">interp</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span>
                <span class="p">)</span>

            <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Wpol&quot;</span><span class="p">,</span> <span class="s2">&quot;Wunpol&quot;</span><span class="p">]:</span>
                <span class="n">mnew</span> <span class="o">=</span> <span class="n">maps</span><span class="o">.</span><span class="n">G3SkyMapWeights</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">wkey</span> <span class="ow">in</span> <span class="n">mnew</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">maps</span><span class="o">.</span><span class="n">reproj_map</span><span class="p">(</span>
                        <span class="n">m</span><span class="p">[</span><span class="n">wkey</span><span class="p">],</span>
                        <span class="n">mnew</span><span class="p">[</span><span class="n">wkey</span><span class="p">],</span>
                        <span class="n">rebin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rebin</span><span class="p">,</span>
                        <span class="n">interp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">interp</span><span class="p">,</span>
                        <span class="n">mask</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">,</span>
                    <span class="p">)</span>

            <span class="n">frame</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">mnew</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">mnew</span>
        <span class="k">return</span> <span class="n">frame</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">mask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The mask to be used for partial reprojection, of the same shape as the</span>
<span class="sd">        output map.  Masked (1) pixels are handled by the reprojection code, and</span>
<span class="sd">        unmasked (0) pixels are skipped, effectively setting their value to 0 in</span>
<span class="sd">        the output map.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mask</span>

    <span class="nd">@mask</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mask</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mask</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">partial</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">maps</span><span class="o">.</span><span class="n">G3SkyMapMask</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mask</span> <span class="o">=</span> <span class="n">mask</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">maps</span><span class="o">.</span><span class="n">G3SkyMap</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mask</span> <span class="o">=</span> <span class="n">maps</span><span class="o">.</span><span class="n">G3SkyMapMask</span><span class="p">(</span>
                    <span class="n">mask</span><span class="p">,</span> <span class="n">use_data</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">zero_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">zero_infs</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="kn">import</span> <span class="nn">healpy</span> <span class="k">as</span> <span class="nn">hp</span>

                <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">mask_copy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">mask</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
                <span class="n">bad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">mask</span><span class="p">),</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">mask</span><span class="p">),</span>
                        <span class="n">mask</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span>
                        <span class="n">hp</span><span class="o">.</span><span class="n">mask_bad</span><span class="p">(</span><span class="n">mask</span><span class="p">),</span>
                    <span class="p">]</span>
                <span class="p">)</span>
                <span class="n">mask_copy</span><span class="p">[</span><span class="n">bad</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">tmp</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">mask_copy</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mask</span> <span class="o">=</span> <span class="n">maps</span><span class="o">.</span><span class="n">G3SkyMapMask</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">use_data</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Mask must be a G3SkyMapMask, G3SkyMap, or numpy array&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mask</span><span class="o">.</span><span class="n">compatible</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Mask is not compatible with output map&quot;</span><span class="p">)</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017-, SPT-3G Collaboration.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>