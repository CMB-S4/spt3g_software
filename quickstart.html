<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Quick Start &#8212; SPT3G Software  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="_static/nature.css?v=279e0f84" />
    <script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Modules" href="modules.html" />
    <link rel="prev" title="SPT3G Software" href="index.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="modules.html" title="Modules"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="SPT3G Software"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">SPT3G Software  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Quick Start</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="quick-start">
<h1><a class="toc-backref" href="#id2" role="doc-backlink">Quick Start</a><a class="headerlink" href="#quick-start" title="Link to this heading">¶</a></h1>
<p><strong>Don’t Panic</strong></p>
<nav class="contents" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#quick-start" id="id2">Quick Start</a></p>
<ul>
<li><p><a class="reference internal" href="#how-to-install" id="id3">How to Install</a></p>
<ul>
<li><p><a class="reference internal" href="#installing-dependencies-on-a-personal-system" id="id4">Installing Dependencies on a Personal System</a></p></li>
<li><p><a class="reference internal" href="#handling-dependencies-on-the-open-science-grid" id="id5">Handling Dependencies on the Open Science Grid</a></p></li>
<li><p><a class="reference internal" href="#handling-dependencies-on-nersc" id="id6">Handling Dependencies on NERSC</a></p></li>
<li><p><a class="reference internal" href="#compilation" id="id7">Compilation</a></p></li>
<li><p><a class="reference internal" href="#installation" id="id8">Installation</a></p></li>
<li><p><a class="reference internal" href="#installation-with-pip" id="id9">Installation with Pip</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#overview" id="id10">Overview</a></p>
<ul>
<li><p><a class="reference internal" href="#frames" id="id11">Frames</a></p></li>
<li><p><a class="reference internal" href="#id1" id="id12">Modules</a></p></li>
<li><p><a class="reference internal" href="#pipelines" id="id13">Pipelines</a></p></li>
<li><p><a class="reference internal" href="#io" id="id14">IO</a></p></li>
<li><p><a class="reference internal" href="#frame-objects" id="id15">Frame Objects</a></p></li>
<li><p><a class="reference internal" href="#units" id="id16">Units</a></p></li>
<li><p><a class="reference internal" href="#debugging-code" id="id17">Debugging Code</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
<section id="how-to-install">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">How to Install</a><a class="headerlink" href="#how-to-install" title="Link to this heading">¶</a></h2>
<p>spt3g_software depends on Boost and cmake, as well as the usual Python packages. Some additional packages (FFTW, GSL, and NetCDF, in particular) will activate optional components of the code if installed. You also need a C++11 compiler. This software is designed to run and work on a variety of operating systems (all Linuxes, Mac OS X, and FreeBSD) and architectures (at least 64-bit x86 and POWER).</p>
<p>Minimum versions:</p>
<ul class="simple">
<li><p>GCC &gt;= 4.7 or clang &gt;= 3.3</p></li>
<li><p>Boost &gt;= 1.48</p></li>
<li><p>cmake &gt;= 3.12</p></li>
<li><p>Python &gt;= 2.7</p></li>
</ul>
<section id="installing-dependencies-on-a-personal-system">
<h3><a class="toc-backref" href="#id4" role="doc-backlink">Installing Dependencies on a Personal System</a><a class="headerlink" href="#installing-dependencies-on-a-personal-system" title="Link to this heading">¶</a></h3>
<p>On Ubuntu/Debian, you can install the non-Python dependencies, including the optional ones, by doing:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>apt-get<span class="w"> </span>install<span class="w"> </span>cmake<span class="w"> </span>libboost-all-dev<span class="w"> </span>libflac-dev<span class="w"> </span>libnetcdf-dev<span class="w"> </span>libfftw3-dev<span class="w"> </span>libgsl0-dev
</pre></div>
</div>
<p>On RHEL-type systems (SL, CentOS, etc.), do this:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>yum<span class="w"> </span>install<span class="w"> </span>cmake<span class="w"> </span>netcdf-devel<span class="w"> </span>boost-devel<span class="w"> </span>flac-devel<span class="w"> </span>fftw-devel<span class="w"> </span>gsl-devel
</pre></div>
</div>
<p>Note that on RHEL/SL versions before 7, you will need a newer compiler than ships with the OS. Please see the clustertools repository for a script in this case.</p>
</section>
<section id="handling-dependencies-on-the-open-science-grid">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">Handling Dependencies on the Open Science Grid</a><a class="headerlink" href="#handling-dependencies-on-the-open-science-grid" title="Link to this heading">¶</a></h3>
<p>On an OSG or other system with OASIS configured, run this before anything else:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nb">eval</span><span class="w"> </span><span class="sb">`</span>/cvmfs/spt.opensciencegrid.org/py3-v4/setup.sh<span class="sb">`</span>
</pre></div>
</div>
<p>This sets up a software environment  with all the packages installed by yum, etc. above that you need for the SPT3G software environment, as well as a variety of standard cosmology and astrophysics tasks. As of late 2022, <cite>py3-v4</cite> is the most recent version of this <a class="reference external" href="https://github.com/SouthPoleTelescope/clustertools">clustertools</a> package; double check that you are using the correct version before you continue. You will obtain best results if you place the line above in your <code class="docutils literal notranslate"><span class="pre">.bash_profile</span></code>. Do <em>not</em> put it in <code class="docutils literal notranslate"><span class="pre">.bashrc</span></code> and make <em>sure</em> that this is the <em>only</em> software installation set up in your bash profile. In particular, take care that there are no references to other python installations (Anaconda, etc.).</p>
</section>
<section id="handling-dependencies-on-nersc">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">Handling Dependencies on NERSC</a><a class="headerlink" href="#handling-dependencies-on-nersc" title="Link to this heading">¶</a></h3>
<p>On NERSC, all dependencies can be installed by ensuring the following <a class="reference external" href="https://docs.nersc.gov/environment/#nersc-modules-environment">modules</a> are loaded with these exact versions (other version combinations may work, but this combination has been tested):</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>PrgEnv-gnu/6.0.5<span class="w"> </span>python/3.7-anaconda-2019.07<span class="w"> </span>gcc/8.2.0<span class="w"> </span>boost/1.72.0<span class="w"> </span>fftw/3.3.8<span class="w"> </span>gsl/2.5
</pre></div>
</div>
<p>Python dependencies like Numpy or others can be installed with pip or conda (the <code class="docutils literal notranslate"><span class="pre">python/3.7-anaconda-2019.07</span></code> module above will give you a <code class="docutils literal notranslate"><span class="pre">pip</span></code> or <code class="docutils literal notranslate"><span class="pre">conda</span></code> command you can use).</p>
<p>Additionally, below when you get to the <code class="docutils literal notranslate"><span class="pre">cmake</span> <span class="pre">..</span></code> command, replace it with:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nv">CC</span><span class="o">=</span>gcc<span class="w"> </span><span class="nv">CXX</span><span class="o">=</span>g++<span class="w"> </span>cmake<span class="w"> </span>..
</pre></div>
</div>
</section>
<section id="compilation">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">Compilation</a><a class="headerlink" href="#compilation" title="Link to this heading">¶</a></h3>
<p>Having installed the appropriate dependencies, return to your checkout and run the following to build the software:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>mkdir<span class="w"> </span>build
<span class="nb">cd</span><span class="w"> </span>build
cmake<span class="w"> </span>..
make
</pre></div>
</div>
<p>Passing <code class="docutils literal notranslate"><span class="pre">-jN</span></code> to <code class="docutils literal notranslate"><span class="pre">make</span></code>, where N is the number of cores you wish to use during building, will speed up the process.</p>
<p>By default, this will use the system’s standard Python installation (whatever you get if you just run <code class="docutils literal notranslate"><span class="pre">python</span></code>). If you want a different python, you can specify that python through passing the argument <code class="docutils literal notranslate"><span class="pre">-DPython_EXECUTABLE=</span></code> to cmake. For example, to use Python 3 if Python 3 is not the default, replace the cmake command above with <code class="docutils literal notranslate"><span class="pre">cmake</span> <span class="pre">-DPython_EXECUTABLE=`which</span> <span class="pre">python3`</span></code>. Note that, if you do this, make <em>sure</em> that a Boost library built for the version of Python you are using exists – generally, installing everything from the system package manager will ensure this.</p>
<p>Once that is complete, you can either use the <code class="docutils literal notranslate"><span class="pre">env-shell.sh</span></code> script in the build directory to set up the appropriate environment variables (PYTHONPATH, etc.):</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>./env-shell.sh
</pre></div>
</div>
<p>Alternatively, you can use <code class="docutils literal notranslate"><span class="pre">pip</span></code> to install the package into whatever Python environment you’d like.  See instructions below.</p>
</section>
<section id="installation">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">Installation</a><a class="headerlink" href="#installation" title="Link to this heading">¶</a></h3>
<p>For various reasons it may be useful to install the software after building, instead of continuing to use it out of the build directory. Several CMake variables control how the software is installed:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">WITH_BZIP2</span></code>, which defaults to <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>, is used to control whether the core library is built with support for bzip2 compression of G3 files.  Use <code class="docutils literal notranslate"><span class="pre">-DWITH_BZIP2=FALSE</span></code> when calling <code class="docutils literal notranslate"><span class="pre">cmake</span></code> to disable.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CMAKE_INSTALL_PREFIX</span></code>, which defaults to <code class="docutils literal notranslate"><span class="pre">/usr/local</span></code> is used as the root directory for installing all non-python components (header files, cmake export scripts, etc.).  This variable is frequently useful when installing into a python virtual environment.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CMAKE_BUILD_PARALLEL_LEVEL</span></code> is an environment variable (<em>not</em> a cmake option) used to control how many parallel processes are used to compile the shared libraries.  This option provides the same behavior as running <code class="docutils literal notranslate"><span class="pre">make</span></code> with the <code class="docutils literal notranslate"><span class="pre">-j</span></code> flag (e.g. <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">-j4</span></code>).</p></li>
</ul>
<p>An uninstall target is also provided, so running <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">uninstall</span></code> from the build directory should remove all files created by a previous <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">install</span></code>.</p>
</section>
<section id="installation-with-pip">
<h3><a class="toc-backref" href="#id9" role="doc-backlink">Installation with Pip</a><a class="headerlink" href="#installation-with-pip" title="Link to this heading">¶</a></h3>
<p>Use <code class="docutils literal notranslate"><span class="pre">pip</span></code> to install the python package.  Ensure that you use the appropriate options as necessary for your installation, e.g. <code class="docutils literal notranslate"><span class="pre">--user</span></code> or <code class="docutils literal notranslate"><span class="pre">--prefix</span></code>.</p>
<p>For pre-built wheels hosted on <a class="reference external" href="https://pypi.org/p/spt3g">PyPI</a>, available for most Linux x86_64, macOS x86_64 and macOS arm64 platforms, simply install the package without any additional options:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>spt3g
</pre></div>
</div>
<p>The hosted wheels will include the necessary libraries (Boost, etc) bundled with the package.  Otherwise, ensure that the dependency libraries are installed as explained above, and processed to one of the following steps.</p>
<p>To install the package from the github repo, run <code class="docutils literal notranslate"><span class="pre">pip</span></code> as usual (this may take a while, so consider setting the <code class="docutils literal notranslate"><span class="pre">CMAKE_BUILD_PARALLEL_LEVEL</span></code> environment variable):</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>spt3g_software
<span class="nv">CMAKE_BUILD_PARALLEL_LEVEL</span><span class="o">=</span><span class="m">4</span><span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-v<span class="w"> </span>.
</pre></div>
</div>
<p>By default this will create a directory called <code class="docutils literal notranslate"><span class="pre">build</span></code> in the repo and run the <code class="docutils literal notranslate"><span class="pre">cmake</span></code> build from there.  The build directory location can be changed by setting the <code class="docutils literal notranslate"><span class="pre">BUILD_DIR</span></code> environment variable, but keep in mind that <code class="docutils literal notranslate"><span class="pre">pip</span></code> requires that the build directory must be a path inside the repo file tree.
For development builds, use the <code class="docutils literal notranslate"><span class="pre">--editable</span></code> option to assemble the python package from the appropriate compiled extensions and python directories:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>spt3g_software
<span class="nv">CMAKE_BUILD_PARALLEL_LEVEL</span><span class="o">=</span><span class="m">4</span><span class="w"> </span><span class="nv">BUILD_DIR</span><span class="o">=</span>build<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-v<span class="w"> </span>--editable<span class="w"> </span>.
</pre></div>
</div>
<p>An editable build adds references to the python directories to your python path, so that edits to library python files are immediately reflected in a fresh python session.</p>
<p>To pass arguments to the cmake build system, use the <code class="docutils literal notranslate"><span class="pre">CMAKE_ARGS</span></code> environment variable with arguments separated by spaces.  For example:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>spt3g_software
<span class="nv">CMAKE_ARGS</span><span class="o">=</span><span class="s2">&quot;-DCMAKE_INSTALL_PREFIX=/usr/local -DCMAKE_MODULE_PATH=/usr/local/share/cmake&quot;</span><span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-v<span class="w"> </span>--prefix<span class="o">=</span>/usr/local<span class="w"> </span>.
</pre></div>
</div>
</section>
</section>
<section id="overview">
<h2><a class="toc-backref" href="#id10" role="doc-backlink">Overview</a><a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<p>The large volume of SPT3G data, even for single observations, has forced some changes in the time-ordered-data processing workflow from previous processing to ensure that a minimum amount of data is in memory and being processed at any given moment. Typically, this minimum quantum of data is a left-right (or right-left) scan, which corresponds to the standard chunk size used in almost all filtering operations. You can of course also write code that runs on longer chunks of data, though this should be avoided where possible to avoid using too much memory. A short overview of the moving parts of the system appears below.</p>
<p>There are three main ingredients to data processing: frames, modules, and pipelines. Details on these topics can be found elsewhere in the manual, in particular in the <a class="reference internal" href="modules.html"><span class="doc">Modules</span></a> and <a class="reference internal" href="frames.html"><span class="doc">Frames</span></a> chapters; a brief overview is given here.</p>
<section id="frames">
<h3><a class="toc-backref" href="#id11" role="doc-backlink">Frames</a><a class="headerlink" href="#frames" title="Link to this heading">¶</a></h3>
<p>Frames (G3Frames) are generic data containers that behave like a python dictionary. They map arbitrary strings to arbitrary data. Here is an example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>In [31]: print frame
Frame (Scan) [
&quot;ACUStatus&quot; (spt3g.gcp.ACUStatusVector) =&gt; 3 elements
&quot;DfMuxHousekeeping&quot; (spt3g.dfmux.DfMuxHousekeepingMap) =&gt; 37 elements
&quot;SourceName&quot; (spt3g.core.G3String) =&gt; &quot;RCW38&quot;
&quot;GCPFeatureBits&quot; (spt3g.core.G3VectorString) =&gt; 1 elements
&quot;RawBoresightAz&quot; (spt3g.core.G3Timestream) =&gt; 386 samples at 190.783 Hz
&quot;RawBoresightEl&quot; (spt3g.core.G3Timestream) =&gt; 386 samples at 190.783 Hz
&quot;RawTimestreams_I&quot; (spt3g.core.G3TimestreamMap) =&gt; Timestreams from 1729 detectors
&quot;RawTimestreams_Q&quot; (spt3g.core.G3TimestreamMap) =&gt; Timestreams from 1729 detectors
&quot;TrackerStatus&quot; (spt3g.gcp.TrackerStatus) =&gt; 300 tracker samples from 21-Apr-2015:01:50:19.010000000 to 21-Apr-2015:01:50:22.000000000
&quot;Turnaround&quot; (spt3g.core.G3Bool) =&gt; True
]
</pre></div>
</div>
<p>This frame contains information from a scan over RCW38 that you can access by the names in the first column, with a summary of their contents on the right. The (Scan) at the top is a description of the kind of data in the frame (e.g. Housekeeping data, a Map, a Scan, etc.)</p>
<p>The types of data you can store in the frame are containers that subclass G3FrameObject. These are listed in the manual for each Python module under the “Frame Objects” heading.</p>
</section>
<section id="id1">
<h3><a class="toc-backref" href="#id12" role="doc-backlink">Modules</a><a class="headerlink" href="#id1" title="Link to this heading">¶</a></h3>
<p>A module is a python callable that does data processing. Modules are passed a frame and can inspect and modify it at will before the frame is passed along to the next module. An example of a module is doing poly filtering on a timestream. As an example of a very simple module:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">simplemod</span><span class="p">(</span><span class="n">frame</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
</pre></div>
</div>
<p>This prints the contents of the frame and does not modify it. As a more complex example, this would print the time at which a DfMux sample was recorded:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">printmuxtime</span><span class="p">(</span><span class="n">frame</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">frame</span><span class="p">[</span><span class="s1">&#39;EventHeader&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>Modifying the frame also works like a dictionary. The following adds the number 5 to every frame:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">five</span><span class="p">(</span><span class="n">frame</span><span class="p">):</span>
    <span class="n">frame</span><span class="p">[</span><span class="s1">&#39;Five&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
</pre></div>
</div>
<p>Much more detail is contained in the <a class="reference internal" href="modules.html"><span class="doc">Modules</span></a> chapter of the documentation.</p>
</section>
<section id="pipelines">
<h3><a class="toc-backref" href="#id13" role="doc-backlink">Pipelines</a><a class="headerlink" href="#pipelines" title="Link to this heading">¶</a></h3>
<p>A pipeline (G3Pipeline) is a sequence of modules. When the pipeline’s Run method is invoked, it will run all modules in sequence for each frame in the data stream. Conceptually, it’s nearly the same as a for loop. For example,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">G3Pipeline</span><span class="p">()</span>
<span class="n">p</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">dostuff</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">dootherstuff</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">Run</span><span class="p">()</span>
</pre></div>
</div>
<p>is equivalent to:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">frames</span><span class="p">:</span>
    <span class="n">dostuff</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
    <span class="n">dootherstuff</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="io">
<h3><a class="toc-backref" href="#id14" role="doc-backlink">IO</a><a class="headerlink" href="#io" title="Link to this heading">¶</a></h3>
<p>Frames can be pickled and unpickled very quickly (1400 MB/s). Two special modules are provided (G3Reader and G3Writer) whose functions are to read and write frames to disk. This provides a full intermediate data format that can dump and restore the state of a pipeline to disk at any point. Something else equivalent to the above example is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">G3Pipeline</span><span class="p">()</span>
<span class="n">p</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">dostuff</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">G3Writer</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;dump.g3&#39;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">Run</span><span class="p">()</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">G3Pipeline</span><span class="p">()</span>
<span class="n">p</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">G3Reader</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;dump.g3&#39;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">dootherstuff</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">Run</span><span class="p">()</span>
</pre></div>
</div>
<p>You can also read files directly:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">core</span><span class="o">.</span><span class="n">G3File</span><span class="p">(</span><span class="s1">&#39;dump.g3&#39;</span><span class="p">):</span>
    <span class="n">dostuff</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
</pre></div>
</div>
<p>If for exploration you would like to load a file into memory the following idiom works.  Do not write code that relies on loading an entire file into memory or everything we’ve done was for naught.  This is just for poking at data:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">frames</span> <span class="o">=</span> <span class="p">[</span><span class="n">fr</span> <span class="k">for</span> <span class="n">fr</span> <span class="ow">in</span> <span class="n">core</span><span class="o">.</span><span class="n">G3File</span><span class="p">(</span><span class="s1">&#39;thefilename.g3&#39;</span><span class="p">)]</span>
</pre></div>
</div>
</section>
<section id="frame-objects">
<h3><a class="toc-backref" href="#id15" role="doc-backlink">Frame Objects</a><a class="headerlink" href="#frame-objects" title="Link to this heading">¶</a></h3>
<p>Frames can store only objects that are subclasses of G3FrameObject or are plain-old-data (numerical scalars, booleans, strings). Notably, you cannot directly store python lists, tuples, or numpy arrays; container classes for these are provided, however. The primary driver for this is that the containers can be shared by C++ and Python code, which allows us to limit the amount of C++ to the cores of algorithms and preserve APIs between the two languages. This makes it much easier to write modules in C++ and Python interchangeably since both languages can access all the data products in the frame using the same interfaces.</p>
<p>The software provides both generic container classes (along the lines of a plain numpy array) and application-specific classes (such as <code class="docutils literal notranslate"><span class="pre">G3Timestream</span></code>) that also contain metadata (for example, start and stop times and units). In general, code should use one of the purpose-specific objects, which makes sure that stored information has all the appropriate metadata attached.</p>
<p>Some classes that hold multiple instances of other datatypes have names starting with either G3Vector, which denotes a list/array, or G3Map, denoting a dictionary from strings to the named type. These names follow the C++ convention.</p>
<p>Classes containing large quantities of numbers (G3Timestream, G3SkyMap, G3VectorDouble) store their data contiguously in memory and implement the Python buffer protocol, which makes numpy operations on these classes behave with the same speed and semantics as on numpy arrays.</p>
<p>Experimental data is stored in one of the following application-specific clASSES:</p>
<ul class="simple">
<li><p><em>G3Timestream</em> acts like a G3VectorDouble with attached sample rate, start time, stop time and units.</p></li>
<li><p><em>G3SkyMap</em> is a base class for actual maps of the sky, and includes units and projection information.</p></li>
<li><p><em>BolometerProperties</em> Stores the physical bolometer information like polarization angle and pointing offset.</p></li>
<li><p><em>DfMuxChannelMapping</em> Is used to map the string identifying a bolometer to its board/module/channel in the dfmux system.</p></li>
</ul>
<p>A few notable generic containers when the standard ones are not appropriate:</p>
<ul class="simple">
<li><p><em>G3VectorDouble</em> is a vector of doubles.  It acts like a numpy array of doubles.</p></li>
<li><p><em>G3MapString</em> acts like a dictionary that maps strings to strings</p></li>
<li><p><em>G3MapVectorDouble</em> acts like a dictionary that maps a string to a vector of doubles</p></li>
</ul>
<p>Frame objects must be defined in both C++ and Python, which can be a bit daunting if you aren’t familiar with C++.  If you <em>need</em> to add an extra member to a G3FrameObject subclass or need a new class, ask on the Slack channel and someone familiar with the C++ side of the software can help with it.</p>
</section>
<section id="units">
<h3><a class="toc-backref" href="#id16" role="doc-backlink">Units</a><a class="headerlink" href="#units" title="Link to this heading">¶</a></h3>
<p>This software includes a units system that is meant to end wondering whether a given function takes radians or degrees as an argument, or whether a stored time is in milliseconds or seconds. The support code is accessible to both C++ and Python as part of the <code class="docutils literal notranslate"><span class="pre">G3Units</span></code> namespace (<code class="docutils literal notranslate"><span class="pre">core.G3Units.X</span></code> in Python and <code class="docutils literal notranslate"><span class="pre">G3Units::X</span></code> in C++).</p>
<p>You should read the documentation on the <a class="reference internal" href="units.html"><span class="doc">Units</span></a> system.</p>
</section>
<section id="debugging-code">
<h3><a class="toc-backref" href="#id17" role="doc-backlink">Debugging Code</a><a class="headerlink" href="#debugging-code" title="Link to this heading">¶</a></h3>
<p>Because of the step-by-step frame handling and callback system, debugging code requires a few more steps than usual.</p>
<p>To break into a debugger session at a certain point in the pipeline, you can use the <code class="docutils literal notranslate"><span class="pre">spt3g.core.InjectDebug</span></code> module.</p>
<p>Another common idiom is to insert a pipeline module that grabs data as it goes by for later examination, which lets you debug as though there were not callbacks. For example,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">stuff</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">def</span> <span class="nf">grabstuff</span><span class="p">(</span><span class="n">fr</span><span class="p">):</span>
    <span class="k">if</span> <span class="s1">&#39;MyData&#39;</span> <span class="ow">in</span> <span class="n">fr</span><span class="p">:</span>
        <span class="n">stuff</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fr</span><span class="p">[</span><span class="s1">&#39;MyData&#39;</span><span class="p">])</span>
<span class="n">pipe</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">grabstuff</span><span class="p">)</span>
</pre></div>
</div>
<p>You can run the unit tests by running <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">test</span></code> in the build directory, which is also a useful, though not sufficient, test that everything is working correctly – expanding test coverage is always a praiseworthy activity.</p>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Quick Start</a><ul>
<li><a class="reference internal" href="#how-to-install">How to Install</a><ul>
<li><a class="reference internal" href="#installing-dependencies-on-a-personal-system">Installing Dependencies on a Personal System</a></li>
<li><a class="reference internal" href="#handling-dependencies-on-the-open-science-grid">Handling Dependencies on the Open Science Grid</a></li>
<li><a class="reference internal" href="#handling-dependencies-on-nersc">Handling Dependencies on NERSC</a></li>
<li><a class="reference internal" href="#compilation">Compilation</a></li>
<li><a class="reference internal" href="#installation">Installation</a></li>
<li><a class="reference internal" href="#installation-with-pip">Installation with Pip</a></li>
</ul>
</li>
<li><a class="reference internal" href="#overview">Overview</a><ul>
<li><a class="reference internal" href="#frames">Frames</a></li>
<li><a class="reference internal" href="#id1">Modules</a></li>
<li><a class="reference internal" href="#pipelines">Pipelines</a></li>
<li><a class="reference internal" href="#io">IO</a></li>
<li><a class="reference internal" href="#frame-objects">Frame Objects</a></li>
<li><a class="reference internal" href="#units">Units</a></li>
<li><a class="reference internal" href="#debugging-code">Debugging Code</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="index.html"
                          title="previous chapter">SPT3G Software</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="modules.html"
                          title="next chapter">Modules</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/quickstart.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="modules.html" title="Modules"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="SPT3G Software"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">SPT3G Software  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Quick Start</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright .
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.2.0.
    </div>
  </body>
</html>