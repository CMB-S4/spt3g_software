<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Network Streaming &#8212; SPT3G Software  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="_static/nature.css?v=279e0f84" />
    <script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Common Problems" href="commonissues.html" />
    <link rel="prev" title="Style Guide" href="styleguide.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="commonissues.html" title="Common Problems"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="styleguide.html" title="Style Guide"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">SPT3G Software  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Network Streaming</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="network-streaming">
<h1><a class="toc-backref" href="#id1" role="doc-backlink">Network Streaming</a><a class="headerlink" href="#network-streaming" title="Link to this heading">¶</a></h1>
<p>The spt3g.core module provides facilities for consuming data from a network host and serving it, through the <code class="docutils literal notranslate"><span class="pre">core.G3Reader</span></code> and <code class="docutils literal notranslate"><span class="pre">core.G3NetworkSender</span></code> classes. Both exchange frames in the same wire format used by files read by <code class="docutils literal notranslate"><span class="pre">core.G3Reader</span></code> over TCP sockets.</p>
<p>While communication is unidirectional from the <code class="docutils literal notranslate"><span class="pre">core.G3NetworkSender</span></code> (or netcat) to a <code class="docutils literal notranslate"><span class="pre">core.G3Reader</span></code> (or netcat), either end of the connection can be a “server” or “client” in the sense of which end of the connection is expected to be listening for the other.</p>
<nav class="contents" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#network-streaming" id="id1">Network Streaming</a></p>
<ul>
<li><p><a class="reference internal" href="#g3networksender" id="id2">G3NetworkSender</a></p>
<ul>
<li><p><a class="reference internal" href="#connecting-to-a-remote-reader" id="id3">Connecting to a Remote Reader</a></p></li>
<li><p><a class="reference internal" href="#functioning-as-a-streaming-server" id="id4">Functioning as a Streaming Server</a></p></li>
<li><p><a class="reference internal" href="#throttling-output-data" id="id5">Throttling output data</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#using-g3reader-over-the-network" id="id6">Using G3Reader Over the Network</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="g3networksender">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">G3NetworkSender</a><a class="headerlink" href="#g3networksender" title="Link to this heading">¶</a></h2>
<p><a class="reference internal" href="#g3networksender">G3NetworkSender</a> can operate in two modes: as a reliable transfer mechanism that connects to a remote G3Reader or as a streaming data source to which remote clients can connect to get the data currently passing through the pipeline.</p>
<section id="connecting-to-a-remote-reader">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">Connecting to a Remote Reader</a><a class="headerlink" href="#connecting-to-a-remote-reader" title="Link to this heading">¶</a></h3>
<p>In the simplest mode, a remote G3Reader (see below) is set up to listen for an incoming connection and <a class="reference internal" href="#g3networksender">G3NetworkSender</a> is pointed at it as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">G3NetworkSender</span><span class="p">,</span> <span class="n">hostname</span><span class="o">=</span><span class="s1">&#39;name.of.remote.host&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">4536</span><span class="p">)</span>
</pre></div>
</div>
<p>This will send every frame passing through the pipeline to the remote host. Note that the output frames are transferred from a second thread, which builds its own unbounded buffer. In the event that file IO is much faster than network IO, this may have the effect of transiently reading the entire input into memory. (This can and should be fixed in a future version of the software)</p>
</section>
<section id="functioning-as-a-streaming-server">
<h3><a class="toc-backref" href="#id4" role="doc-backlink">Functioning as a Streaming Server</a><a class="headerlink" href="#functioning-as-a-streaming-server" title="Link to this heading">¶</a></h3>
<p>This is the standard operational mode of <a class="reference internal" href="#g3networksender">G3NetworkSender</a>. When operating as a streaming server, remote clients connect to it and receive the most recent of any metadata frames (Calibration, Wiring, etc. – anything that is not a Timepoint or Scan frame), followed by all passing data beginning at the time of connection. This is designed for use, for example, in monitoring data acquisition.</p>
<p>Streaming server mode is established by using the special hostname <code class="docutils literal notranslate"><span class="pre">*</span></code>. To create a streaming server:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">G3NetworkSender</span><span class="p">,</span> <span class="n">hostname</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">4536</span><span class="p">)</span>
</pre></div>
</div>
<p>This can be connected to on the remote end by doing:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">G3Reader</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;tcp://name.of.streamer.host:4536&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>By default, this will send every frame starting at the instant of connection. For a monitoring system with potentially unreliable or slow data links, setting the <code class="docutils literal notranslate"><span class="pre">max_queue_size</span></code> option will limit the growth of buffers, dropping Timepoint or Scan frames in the event of network latency rather than buffering a number of frames larger than the <code class="docutils literal notranslate"><span class="pre">max_queue_size</span></code> parameter.</p>
<p>For example, the following will only allow the remote end to fall ten frames behind before it starts dropping data. When the remote end comes back from a potential transient disruption, it will then be in the present rather than slowly clearing a backup using memory on the server. Note that metadata frames (Housekeeping, Wiring, etc.) important for maintaining the state of the pipeline will <em>never</em> be dropped, no matter what the setting of <code class="docutils literal notranslate"><span class="pre">max_queue_size</span></code> is.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">G3NetworkSender</span><span class="p">,</span> <span class="n">hostname</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">4536</span><span class="p">,</span> <span class="n">max_queue_size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="throttling-output-data">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">Throttling output data</a><a class="headerlink" href="#throttling-output-data" title="Link to this heading">¶</a></h3>
<p>An additional class called G3ThrottledNetworkSender wraps <a class="reference internal" href="#g3networksender">G3NetworkSender</a> but with a data reduction step that sends only every Nth of some list of frame types. For example, the following sends all non-Timepoint frames and every 10th Timepoint frame with a configuration otherwise identical to the example in the previous section:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">G3ThrottledNetworkSender</span><span class="p">,</span> <span class="n">hostname</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">4536</span><span class="p">,</span> <span class="n">max_queue_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">frame_decimation</span> <span class="o">=</span> <span class="p">{</span><span class="n">G3FrameType</span><span class="o">.</span><span class="n">Timepoint</span><span class="p">:</span> <span class="mi">10</span><span class="p">})</span>
</pre></div>
</div>
<p>Other frame types can be added by appending them to the dictionary. All instances of frame types not occurring in the dictionary will be sent.</p>
</section>
</section>
<section id="using-g3reader-over-the-network">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Using G3Reader Over the Network</a><a class="headerlink" href="#using-g3reader-over-the-network" title="Link to this heading">¶</a></h2>
<p>G3Reader, in addition to opening files, can read from network sockets by passing it a URL of the form <code class="docutils literal notranslate"><span class="pre">tcp://host:port</span></code> instead of a file path.</p>
<p>To connect to the streaming server examples above, for example, you can add a G3Reader with the following configuration:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">G3Reader</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;tcp://name.of.streamer.host:4536&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Real files and network sockets can be mixed. For example, if you want to stream real-time data from the DAQ system with some calibration information prefixed:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">G3Reader</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;/path/to/some/cal/data&#39;</span><span class="p">,</span> <span class="s1">&#39;tcp://name.of.streamer.host:4536&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>If the remote end closes the connection (as happens when the pipe in which <a class="reference internal" href="#g3networksender">G3NetworkSender</a> is running finishes), G3Reader will interpret that as the end of the file and either move onto the next file or exit, as appropriate.</p>
<p>Like <a class="reference internal" href="#g3networksender">G3NetworkSender</a>, G3Reader also has a listen mode in which it will wait for a connection on a given port from an external source instead of connecting to a remote host itself. The semantics of its operation are otherwise identical to the connect-to-remote-host mode. Like <a class="reference internal" href="#g3networksender">G3NetworkSender</a>, this mode is triggered by the special host name <code class="docutils literal notranslate"><span class="pre">*</span></code>. To make G3Reader wait for a remote connection on port 4536:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">G3Reader</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;tcp://*:4536&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Network Streaming</a><ul>
<li><a class="reference internal" href="#g3networksender">G3NetworkSender</a><ul>
<li><a class="reference internal" href="#connecting-to-a-remote-reader">Connecting to a Remote Reader</a></li>
<li><a class="reference internal" href="#functioning-as-a-streaming-server">Functioning as a Streaming Server</a></li>
<li><a class="reference internal" href="#throttling-output-data">Throttling output data</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-g3reader-over-the-network">Using G3Reader Over the Network</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="styleguide.html"
                          title="previous chapter">Style Guide</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="commonissues.html"
                          title="next chapter">Common Problems</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/networkstreaming.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="commonissues.html" title="Common Problems"
             >next</a> |</li>
        <li class="right" >
          <a href="styleguide.html" title="Style Guide"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">SPT3G Software  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Network Streaming</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright .
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.2.0.
    </div>
  </body>
</html>